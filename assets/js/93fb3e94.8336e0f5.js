"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[2324],{5680:(e,t,n)=>{n.d(t,{xA:()=>u,yg:()=>d});var a=n(6540);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},g="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),g=p(n),m=r,d=g["".concat(s,".").concat(m)]||g[m]||c[m]||i;return n?a.createElement(d,o(o({ref:t},u),{},{components:n})):a.createElement(d,o({ref:t},u))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[g]="string"==typeof e?e:r,o[1]=l;for(var p=2;p<i;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},4046:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>c,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var a=n(8168),r=(n(6540),n(5680));const i={sidebar_position:1,title:"Automated Authorization Pull Requests",image:"/img/quick-tutorials/github/social.png"},o=void 0,l={unversionedId:"features/github/tutorials/automated-pull-requests",id:"features/github/tutorials/automated-pull-requests",title:"Automated Authorization Pull Requests",description:"Otterize integrates with GitHub repositories to automatically generate pull requests as application access requirements change in the cluster. This enables platform administrators to continuously align security requirements with code updates.",source:"@site/docs/features/github/tutorials/automated-pull-requests.mdx",sourceDirName:"features/github/tutorials",slug:"/features/github/tutorials/automated-pull-requests",permalink:"/features/github/tutorials/automated-pull-requests",draft:!1,editUrl:"https://github.com/otterize/docs/edit/main/docs/features/github/tutorials/automated-pull-requests.mdx",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,title:"Automated Authorization Pull Requests",image:"/img/quick-tutorials/github/social.png"},sidebar:"docSidebar",previous:{title:"GitHub | Overview",permalink:"/features/github/"},next:{title:"Reference",permalink:"/features/github/reference"}},s={},p=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"CLI tools",id:"cli-tools",level:3},{value:"Deploy Otterize",id:"deploy-otterize",level:3},{value:"Tutorial",id:"tutorial",level:2},{value:"Deploy the application",id:"deploy-the-application",level:3},{value:"Export and apply ClientIntents",id:"export-and-apply-clientintents",level:3},{value:"Create the repository",id:"create-the-repository",level:3},{value:"Add the GitHub repository to Otterize Cloud",id:"add-the-github-repository-to-otterize-cloud",level:3},{value:"Update the application",id:"update-the-application",level:3},{value:"Check for a new pull request",id:"check-for-a-new-pull-request",level:3},{value:"Teardown",id:"teardown",level:2}],u={toc:p},g="wrapper";function c(e){let{components:t,...n}=e;return(0,r.yg)(g,(0,a.A)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.yg)("p",null,"Otterize integrates with GitHub repositories to automatically generate pull requests as application access requirements change in the cluster. This enables platform administrators to continuously align security requirements with code updates."),(0,r.yg)("p",null,"In this tutorial, you will:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Deploy a sample application."),(0,r.yg)("li",{parentName:"ul"},"Create a Git repository to store ClientIntents manifests."),(0,r.yg)("li",{parentName:"ul"},"Integrate a new Git repository into Otterize Cloud and install Otterize\u2019s GitHub app."),(0,r.yg)("li",{parentName:"ul"},"Modify application communication patterns, thereby triggering Otterize to create a pull request with the updated ClientIntents.")),(0,r.yg)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.yg)("h3",{id:"cli-tools"},"CLI tools"),(0,r.yg)("p",null,"You will need the following CLI tools to set up the repository and export ClientIntents:"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("a",{parentName:"li",href:"https://docs.otterize.com/overview/installation#install-the-otterize-cli"},"Otterize CLI")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("a",{parentName:"li",href:"https://cli.github.com"},"Github CLI"))),(0,r.yg)("p",null,"After installation, log in  with ",(0,r.yg)("inlineCode",{parentName:"p"},"gh auth login")," and select your preferred method for authentication. Ensure your account has the necessary permissions to create new repositories."),(0,r.yg)("h3",{id:"deploy-otterize"},"Deploy Otterize"),(0,r.yg)("p",null,"With a Kubernetes cluster ready, head over to ",(0,r.yg)("a",{parentName:"p",href:"https://app.otterize.com/"},"Otterize Cloud")," and navigate to the ",(0,r.yg)("a",{parentName:"p",href:"https://app.otterize.com/integrations"},"integrations page")," to deploy Otterize. Follow the provided instructions to integrate your cluster."),(0,r.yg)("h2",{id:"tutorial"},"Tutorial"),(0,r.yg)("h3",{id:"deploy-the-application"},"Deploy the application"),(0,r.yg)("p",null,"Use the following command to set up the tutorial namespace and deploy a sample application simulating a fantasy tabletop game. The application comprises several services responsible for different aspects of the game."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-yaml"},"kubectl apply -n otterize-tutorial-github -f ${ABSOLUTE_URL}/code-examples/github/all.yaml\n")),(0,r.yg)("details",null,(0,r.yg)("summary",null,"View Deployment"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: v1\nkind: Namespace\nmetadata:\n  name: otterize-tutorial-github\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: adventure\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: adventure\n  template:\n    metadata:\n      labels:\n        app: adventure\n    spec:\n      containers:\n        - name: github-tutorial\n          image: otterize/github-tutorial:latest\n          args: ["./adventure"]\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: character-generator\nspec:\n  selector:\n    matchLabels:\n      app: character-generator\n  template:\n    metadata:\n      labels:\n        app: character-generator\n    spec:\n      containers:\n        - name: github-tutorial\n          image: otterize/github-tutorial:latest\n          args: ["./character-generator"]\n          ports:\n            - containerPort: 8080\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: quest-generator\nspec:\n  selector:\n    matchLabels:\n      app: quest-generator\n  template:\n    metadata:\n      labels:\n        app: quest-generator\n    spec:\n      containers:\n        - name: github-tutorial\n          image: otterize/github-tutorial:latest\n          args: ["./quest-generator"]\n          ports:\n            - containerPort: 8080\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: monster-generator\nspec:\n  selector:\n    matchLabels:\n      app: monster-generator\n  template:\n    metadata:\n      labels:\n        app: monster-generator\n    spec:\n      containers:\n        - name: github-tutorial\n          image: otterize/github-tutorial:latest\n          args: ["./monster-generator"]\n          ports:\n            - containerPort: 8080\n\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: treasure-generator\nspec:\n  selector:\n    matchLabels:\n      app: treasure-generator\n  template:\n    metadata:\n      labels:\n        app: treasure-generator\n    spec:\n      containers:\n        - name: github-tutorial\n          image: otterize/github-tutorial:latest\n          args: ["./treasure-generator"]\n          ports:\n            - containerPort: 8080\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: treasure-generator\nspec:\n  type: ClusterIP\n  selector:\n    app: treasure-generator\n  ports:\n    - name: http\n      port: 8080\n      targetPort: 8080\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: character-generator\nspec:\n  type: ClusterIP\n  selector:\n    app: character-generator\n  ports:\n    - name: http\n      port: 8080\n      targetPort: 8080\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: monster-generator\nspec:\n  type: ClusterIP\n  selector:\n    app: monster-generator\n  ports:\n    - name: http\n      port: 8080\n      targetPort: 8080\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: quest-generator\nspec:\n  type: ClusterIP\n  selector:\n    app: quest-generator\n  ports:\n    - name: http\n      port: 8080\n      targetPort: 8080\n---\n'))),(0,r.yg)("p",null,"Once the deployment is complete , you can view the application's network map on Otterize Cloud. Turn on ",(0,r.yg)("inlineCode",{parentName:"p"},"Assume default deny")," under network policies, as shown in the picture below."),(0,r.yg)("img",{src:"/img/quick-tutorials/github/visual-graph-assume-default-deny.png",alt:"visual graph of default deny network policy",style:{width:200}}),(0,r.yg)("p",null,"The connections will turn red."),(0,r.yg)("img",{src:"/img/quick-tutorials/github/visual-graph-unsecure-deploy.png",alt:"visual graph of cluster deployment"}),(0,r.yg)("h3",{id:"export-and-apply-clientintents"},"Export and apply ClientIntents"),(0,r.yg)("p",null,"Otterize can automatically generate application access rules based on the actual network traffic detected by the network-mapper."),(0,r.yg)("p",null,"Use the Otterize CLI tool to export the recommended intent definitions. You can also access these definitions directly from the Access Graph on Otterize Cloud."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"mkdir otterize-tutorial-github\ncd otterize-tutorial-github\nmkdir intents\notterize network-mapper export -n otterize-tutorial-github > ./intents/intents.yaml\n")),(0,r.yg)("details",null,(0,r.yg)("summary",null,"View intents.yaml"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: k8s.otterize.com/v1alpha3\nkind: ClientIntents\nmetadata:\n  name: adventure\n  namespace: otterize-tutorial-github\nspec:\n  service:\n    name: adventure\n  calls:\n    - name: character-generator\n    - name: monster-generator\n    - name: quest-generator\n    - name: treasure-generator\n"))),(0,r.yg)("p",null,"Next, secure the application's pods by applying these intents to the cluster."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"kubectl apply -n otterize-tutorial-github -f ./intents/intents.yaml\n")),(0,r.yg)("p",null,"In the Access Graph, the ",(0,r.yg)("em",{parentName:"p"},"adventure")," client is now allowed to access the protected services."),(0,r.yg)("img",{src:"/img/quick-tutorials/github/protected-services.gif",alt:"visual graph of cluster deployment with protected edges"}),(0,r.yg)("h3",{id:"create-the-repository"},"Create the repository"),(0,r.yg)("p",null,"To ensure versioned records, create a Git repository, stage and commit the applied intents. Then push the changes to the main branch. "),(0,r.yg)("p",null,"Make sure you are in the ",(0,r.yg)("inlineCode",{parentName:"p"},"otterize-tutorial-github")," directory before executing the following commands."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"export GH_USER=$(gh api user | jq -r '.login')\ngh repo create otterize-tutorial-github --private\ngit init\ngit add .\ngit commit -m \"Initial Intents\"\ngit branch -M main\ngit remote add origin https://github.com/$GH_USER/otterize-tutorial-github.git\ngit push -u origin main\n")),(0,r.yg)("p",null,"The repository can now be integrated to Otterize cloud to detect drifts in case of changes in traffic patterns."),(0,r.yg)("h3",{id:"add-the-github-repository-to-otterize-cloud"},"Add the GitHub repository to Otterize Cloud"),(0,r.yg)("admonition",{type:"tip"},(0,r.yg)("p",{parentName:"admonition"},"In this section, you will use the ",(0,r.yg)("em",{parentName:"p"},"main")," branch to track ClientIntents changes.For production environments, we recommend monitoring traffic changes in other long-held branches, such as ",(0,r.yg)("em",{parentName:"p"},"development"),", ",(0,r.yg)("em",{parentName:"p"},"test"),", or ",(0,r.yg)("em",{parentName:"p"},"staging"),". You can then deploy the new compiled ClientIntents in production with your preferred tool.")),(0,r.yg)("p",null,"To add the repository to Otterize Cloud, navigate to the ",(0,r.yg)("a",{parentName:"p",href:"https://app.otterize.com/integrations"},"Integrations page"),"."),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},"Click ",(0,r.yg)("inlineCode",{parentName:"li"},"Add Integration"),"."),(0,r.yg)("li",{parentName:"ol"},"Select integration type: ",(0,r.yg)("inlineCode",{parentName:"li"},"GitHub"),"."),(0,r.yg)("li",{parentName:"ol"},"Provide the name ",(0,r.yg)("em",{parentName:"li"},"otterize-tutorial-github")," as the integration."),(0,r.yg)("li",{parentName:"ol"},"In the ",(0,r.yg)("inlineCode",{parentName:"li"},"On Trigger")," section, select your Kubernetes cluster, and leave the other options set to the predefined defaults."),(0,r.yg)("li",{parentName:"ol"},"In the ",(0,r.yg)("inlineCode",{parentName:"li"},"Open PR on")," section, select the ",(0,r.yg)("inlineCode",{parentName:"li"},"Repository")," field, and provide the owner and organization names in the form: ",(0,r.yg)("em",{parentName:"li"},"<github user name",">","/otterize-tutorial-github"),"."),(0,r.yg)("li",{parentName:"ol"},"Select the ",(0,r.yg)("inlineCode",{parentName:"li"},"Base Branch")," field, and enter ",(0,r.yg)("em",{parentName:"li"},"main"),"."),(0,r.yg)("li",{parentName:"ol"},"Select the ",(0,r.yg)("inlineCode",{parentName:"li"},"ClientIntents path")," field, and enter ",(0,r.yg)("inlineCode",{parentName:"li"},"intents"),". It represents the relative path hosting the ClientIntents manifests."),(0,r.yg)("li",{parentName:"ol"},"Next, click the ",(0,r.yg)("inlineCode",{parentName:"li"},"Add")," button. This will redirect you to GitHub. If needed, select your GitHub account that owns the tutorial repository and click ",(0,r.yg)("inlineCode",{parentName:"li"},"continue"),". Then, select the desired organization and the tutorial repository (",(0,r.yg)("em",{parentName:"li"},"otterize-tutorial-github"),"), as depicted in the picture below. Finally, click on ",(0,r.yg)("inlineCode",{parentName:"li"},"Install"),".")),(0,r.yg)("img",{className:"tw-w-96 tw-block tw-mx-auto tw-mb-4",src:"/img/quick-tutorials/github/install-github-app.png",alt:"Github App Install Example"}),(0,r.yg)("p",null,"The Otterize GitHub app is now installed in your repository. Otterize will continuously monitor for differences between the ClientIntents definitions in your repository and the actual usage detected in your cluster. If drifts are detected, pull requests will be automatically opened to update the intent definitions and reflect the new usage behaviors."),(0,r.yg)("p",null,"You can learn more about GitHub configuration and how to use the Triggers on the ",(0,r.yg)("a",{parentName:"p",href:"/features/github/reference"},"Reference page")),(0,r.yg)("h3",{id:"update-the-application"},"Update the application"),(0,r.yg)("p",null,"In the original deployment, the game simulation's ",(0,r.yg)("em",{parentName:"p"},"adventure")," pod utilized the ",(0,r.yg)("em",{parentName:"p"},"monster-generator")," pod to fetch a random monster. An improved version, ",(0,r.yg)("em",{parentName:"p"},"monster-generator-v2"),", has just been released and is ready for deployment."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"kubectl apply -n otterize-tutorial-github -f ${ABSOLUTE_URL}/code-examples/github/all-v2.yaml\n")),(0,r.yg)("p",null,"Once the pod is deployed, check the logs of the ",(0,r.yg)("em",{parentName:"p"},"adventure")," pod using the command below. It should reflect the new application version."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"kubectl logs -f -n otterize-tutorial-github deploy/adventure\n")),(0,r.yg)("p",null,"Here is an example of the expected output."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},"****************************************************\nLet another great adventure begin!\n****************************************************\nUsing MonsterV2 generated monster\nWelcome to your adventure, Elf Wizard!\nYour quest: Escort the Caravan\nBeware, a wild Elephant appears!\nThe Elephant has 90 hit points, Our Elf has 244 points.\n---------------------------------------------\nElf lands a 19 point strike against the smelly Beast!\nElephant hits our strong Elf doing 20 point of damage.\nThe Elephant has 71 hit points, Our Elf has 224 points.\n")),(0,r.yg)("p",null,(0,r.yg)("em",{parentName:"p"},"monster-generator-v2")," is now displayed in Otterize Cloud Access Graph."),(0,r.yg)("img",{src:"/img/quick-tutorials/github/visual-graph-updated-services.png",alt:"visual graph of cluster deployment"}),(0,r.yg)("h3",{id:"check-for-a-new-pull-request"},"Check for a new pull request"),(0,r.yg)("p",null,"Following the introduction of a new application component, the network-mapper has detected a new connection and updated Otterize cloud. This update has triggered the GitHub integration, resulting in the submission of a new pull request."),(0,r.yg)("img",{src:"/img/quick-tutorials/github/pull-request.png",alt:"visual graph of cluster deployment"}),(0,r.yg)("p",null,"Finally, merge the pull request and deploy the updated ClientIntents manifest."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-text"},"gh pr merge 1 -m\nkubectl apply -n otterize-tutorial-github -f ./intents/intents.yaml\n")),(0,r.yg)("h2",{id:"teardown"},"Teardown"),(0,r.yg)("p",null,"Delete the application."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-*bash*"},"kubectl delete namespace otterize-tutorial-github\n")),(0,r.yg)("p",null,"Delete the Git repository with the following command, replacing the GitHub user name with yours."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"gh repo delete $GH_USER/otterize-tutorial-github\n")),(0,r.yg)("admonition",{type:"note"},(0,r.yg)("p",{parentName:"admonition"},"If your API doesn't grant ",(0,r.yg)("em",{parentName:"p"},"delete")," privileges, navigate to the repository's ",(0,r.yg)("em",{parentName:"p"},"Settings")," section to delete it manually.")),(0,r.yg)("p",null,"Finally, you can delete your local copy of the repository."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"cd ..\nrm -rf otterize-tutorial-github\n")))}c.isMDXComponent=!0}}]);