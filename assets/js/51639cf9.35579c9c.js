"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7199,8401],{9365:(e,t,n)=>{n.d(t,{A:()=>r});var a=n(6540),o=n(53);const l={tabItem:"tabItem_Ymn6"};function r(e){let{children:t,hidden:n,className:r}=e;return a.createElement("div",{role:"tabpanel",className:(0,o.A)(l.tabItem,r),hidden:n},t)}},1470:(e,t,n)=>{n.d(t,{A:()=>v});var a=n(8168),o=n(6540),l=n(53),r=n(3104),s=n(6347),i=n(7485),c=n(1682),u=n(9466);function p(e){return function(e){return o.Children.map(e,(e=>{if(!e||(0,o.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:t,label:n,attributes:a,default:o}}=e;return{value:t,label:n,attributes:a,default:o}}))}function d(e){const{values:t,children:n}=e;return(0,o.useMemo)((()=>{const e=t??p(n);return function(e){const t=(0,c.X)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function m(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function g(e){let{queryString:t=!1,groupId:n}=e;const a=(0,s.W6)(),l=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,i.aZ)(l),(0,o.useCallback)((e=>{if(!l)return;const t=new URLSearchParams(a.location.search);t.set(l,e),a.replace({...a.location,search:t.toString()})}),[l,a])]}function h(e){const{defaultValue:t,queryString:n=!1,groupId:a}=e,l=d(e),[r,s]=(0,o.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!m({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const a=n.find((e=>e.default))??n[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:t,tabValues:l}))),[i,c]=g({queryString:n,groupId:a}),[p,h]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[a,l]=(0,u.Dv)(n);return[a,(0,o.useCallback)((e=>{n&&l.set(e)}),[n,l])]}({groupId:a}),y=(()=>{const e=i??p;return m({value:e,tabValues:l})?e:null})();(0,o.useLayoutEffect)((()=>{y&&s(y)}),[y]);return{selectedValue:r,selectValue:(0,o.useCallback)((e=>{if(!m({value:e,tabValues:l}))throw new Error(`Can't select invalid tab value=${e}`);s(e),c(e),h(e)}),[c,h,l]),tabValues:l}}var y=n(2303);const k={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function w(e){let{className:t,block:n,selectedValue:s,selectValue:i,tabValues:c}=e;const u=[],{blockElementScrollPositionUntilNextRender:p}=(0,r.a_)(),d=e=>{const t=e.currentTarget,n=u.indexOf(t),a=c[n].value;a!==s&&(p(t),i(a))},m=e=>{let t=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const n=u.indexOf(e.currentTarget)+1;t=u[n]??u[0];break}case"ArrowLeft":{const n=u.indexOf(e.currentTarget)-1;t=u[n]??u[u.length-1];break}}t?.focus()};return o.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.A)("tabs",{"tabs--block":n},t)},c.map((e=>{let{value:t,label:n,attributes:r}=e;return o.createElement("li",(0,a.A)({role:"tab",tabIndex:s===t?0:-1,"aria-selected":s===t,key:t,ref:e=>u.push(e),onKeyDown:m,onClick:d},r,{className:(0,l.A)("tabs__item",k.tabItem,r?.className,{"tabs__item--active":s===t})}),n??t)})))}function b(e){let{lazy:t,children:n,selectedValue:a}=e;const l=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=l.find((e=>e.props.value===a));return e?(0,o.cloneElement)(e,{className:"margin-top--md"}):null}return o.createElement("div",{className:"margin-top--md"},l.map(((e,t)=>(0,o.cloneElement)(e,{key:t,hidden:e.props.value!==a}))))}function f(e){const t=h(e);return o.createElement("div",{className:(0,l.A)("tabs-container",k.tabList)},o.createElement(w,(0,a.A)({},e,t)),o.createElement(b,(0,a.A)({},e,t)))}function v(e){const t=(0,y.A)();return o.createElement(f,(0,a.A)({key:String(t)},e))}},1202:(e,t,n)=>{n.d(t,{A:()=>L});var a=n(8168),o=n(6540),l=n(2303),r=n(53),s=n(6058),i=n(7559),c=n(4291);const u={codeBlockContainer:"codeBlockContainer_APcc"};function p(e){let{as:t,...n}=e;const l=(0,s.A)(),p=(0,c.M$)(l);return o.createElement(t,(0,a.A)({},n,{style:p,className:(0,r.A)(n.className,u.codeBlockContainer,i.G.common.codeBlock)}))}const d={codeBlockContent:"codeBlockContent_m3Ux",codeBlockTitle:"codeBlockTitle_P25_",codeBlock:"codeBlock_qGQc",codeBlockStandalone:"codeBlockStandalone_zC50",codeBlockLines:"codeBlockLines_p187",codeBlockLinesWithNumbering:"codeBlockLinesWithNumbering_OFgW",buttonGroup:"buttonGroup_6DOT"};function m(e){let{children:t,className:n}=e;return o.createElement(p,{as:"pre",tabIndex:0,className:(0,r.A)(d.codeBlockStandalone,"thin-scrollbar",n)},o.createElement("code",{className:d.codeBlockLines},t))}var g=n(6342),h=n(6591),y=n(8382);const k={codeLine:"codeLine_iPqp",codeLineNumber:"codeLineNumber_F4P7",codeLineContent:"codeLineContent_pOih"};var w=n(6025);function b(e){let{line:t,classNames:n,showLineNumbers:l,getLineProps:s,getTokenProps:i}=e;1===t.length&&"\n"===t[0].content&&(t[0].content="");const c=s({line:t,className:(0,r.A)(n,l&&k.codeLine)}),u=t.map(((e,t)=>o.createElement("span",(0,a.A)({key:t},i({token:e,key:t})))));return o.createElement("span",c,l?o.createElement(o.Fragment,null,o.createElement("span",{className:k.codeLineNumber}),o.createElement("span",{className:k.codeLineContent},u)):u,o.createElement("br",null))}var f=n(9242),v=n(1312),N=n(1473),A=n(4115);const C={copyButtonCopied:"copyButtonCopied__QnY",copyButtonIcons:"copyButtonIcons_FhaS",copyButtonIcon:"copyButtonIcon_phi_",copyButtonSuccessIcon:"copyButtonSuccessIcon_FfTR"};function E(e){let{code:t,className:n}=e;const[a,l]=(0,o.useState)(!1),s=(0,o.useRef)(void 0),i=(0,o.useCallback)((()=>{(0,f.A)(t),l(!0),s.current=window.setTimeout((()=>{l(!1)}),1e3)}),[t]);return(0,o.useEffect)((()=>()=>window.clearTimeout(s.current)),[]),o.createElement("button",{type:"button","aria-label":a?(0,v.T)({id:"theme.CodeBlock.copied",message:"Copied",description:"The copied button label on code blocks"}):(0,v.T)({id:"theme.CodeBlock.copyButtonAriaLabel",message:"Copy code to clipboard",description:"The ARIA label for copy code blocks button"}),title:(0,v.T)({id:"theme.CodeBlock.copy",message:"Copy",description:"The copy button label on code blocks"}),className:(0,r.A)("clean-btn",n,C.copyButton,a&&C.copyButtonCopied),onClick:i},o.createElement("span",{className:C.copyButtonIcons,"aria-hidden":"true"},o.createElement(N.A,{className:C.copyButtonIcon}),o.createElement(A.A,{className:C.copyButtonSuccessIcon})))}var S=n(5048);const I={wordWrapButtonIcon:"wordWrapButtonIcon_iowe",wordWrapButtonEnabled:"wordWrapButtonEnabled_gY8A"};function B(e){let{className:t,onClick:n,isEnabled:a}=e;const l=(0,v.T)({id:"theme.CodeBlock.wordWrapToggle",message:"Toggle word wrap",description:"The title attribute for toggle word wrapping button of code block lines"});return o.createElement("button",{type:"button",onClick:n,className:(0,r.A)("clean-btn",t,a&&I.wordWrapButtonEnabled),"aria-label":l,title:l},o.createElement(S.A,{className:I.wordWrapButtonIcon,"aria-hidden":"true"}))}function T(e){let{children:t,className:n="",metastring:l,title:i,showLineNumbers:u,language:m}=e;const{prism:{defaultLanguage:k,magicComments:f}}=(0,g.p)(),v=m??(0,c.Op)(n)??k,N=(0,s.A)(),A=(0,h.f)(),C=(0,c.wt)(l)||i,{lineClassNames:S,code:I}=(0,c.Li)(t,{metastring:l,language:v,magicComments:f}),T=(0,w.A)("/",{absolute:!0}).slice(0,-1),L=I.replaceAll("${ABSOLUTE_URL}",T),z=u??(0,c._u)(l);return o.createElement(p,{as:"div",className:(0,r.A)(n,v&&!n.includes(`language-${v}`)&&`language-${v}`)},C&&o.createElement("div",{className:d.codeBlockTitle},C),o.createElement("div",{className:d.codeBlockContent},o.createElement(y.Ay,(0,a.A)({},y.Gs,{theme:N,code:L,language:v??"text"}),(e=>{let{className:t,tokens:n,getLineProps:a,getTokenProps:l}=e;return o.createElement("pre",{tabIndex:0,ref:A.codeBlockRef,className:(0,r.A)(t,d.codeBlock,"thin-scrollbar")},o.createElement("code",{className:(0,r.A)(d.codeBlockLines,z&&d.codeBlockLinesWithNumbering)},n.map(((e,t)=>o.createElement(b,{key:t,line:e,getLineProps:a,getTokenProps:l,classNames:S[t],showLineNumbers:z})))))})),o.createElement("div",{className:d.buttonGroup},(A.isEnabled||A.isCodeScrollable)&&o.createElement(B,{className:d.codeButton,onClick:()=>A.toggle(),isEnabled:A.isEnabled}),o.createElement(E,{className:d.codeButton,code:L}))))}function L(e){let{children:t,...n}=e;const r=(0,l.A)(),s=function(e){return o.Children.toArray(e).some((e=>(0,o.isValidElement)(e)))?e:Array.isArray(e)?e.join(""):e}(t),i="string"==typeof s?T:m;return o.createElement(i,(0,a.A)({key:String(r)},n),s)}},4707:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>r,default:()=>d,frontMatter:()=>l,metadata:()=>s,toc:()=>c});var a=n(8168),o=(n(6540),n(5680));n(1202),n(1470),n(9365);const l={sidebar_position:4,title:"AWS EKS network policies with the VPC CNI",image:"/img/quick-tutorials/aws-eks-mini/social.png"},r=void 0,s={unversionedId:"features/network-mapping-network-policies/tutorials/aws-eks-cni-mini",id:"features/network-mapping-network-policies/tutorials/aws-eks-cni-mini",title:"AWS EKS network policies with the VPC CNI",description:"This tutorial will walk you through deploying an AWS EKS cluster with the AWS VPC CNI add-on, while enabling the new network policy support on EKS with Otterize.",source:"@site/docs/features/network-mapping-network-policies/tutorials/aws-eks-cni-mini.mdx",sourceDirName:"features/network-mapping-network-policies/tutorials",slug:"/features/network-mapping-network-policies/tutorials/aws-eks-cni-mini",permalink:"/features/network-mapping-network-policies/tutorials/aws-eks-cni-mini",draft:!1,editUrl:"https://github.com/otterize/docs/edit/main/docs/features/network-mapping-network-policies/tutorials/aws-eks-cni-mini.mdx",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4,title:"AWS EKS network policies with the VPC CNI",image:"/img/quick-tutorials/aws-eks-mini/social.png"},sidebar:"docSidebar",previous:{title:"Protecting a service with network policies",permalink:"/features/network-mapping-network-policies/tutorials/protect-1-service-network-policies"},next:{title:"Egress NetworkPolicy Automation",permalink:"/features/network-mapping-network-policies/tutorials/k8s-egress-access-control-tutorial"}},i={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Tutorial",id:"tutorial",level:2},{value:"Step one: Create an AWS EKS cluster with the AWS VPC CNI plugin",id:"step-one-create-an-aws-eks-cluster-with-the-aws-vpc-cni-plugin",level:3},{value:"Step two: Install the Otterize agents",id:"step-two-install-the-otterize-agents",level:3},{value:"Install Otterize on your cluster",id:"install-otterize-on-your-cluster",level:3},{value:"Deploy a server and two clients",id:"deploy-a-server-and-two-clients",level:3},{value:"Step three: Create an intent",id:"step-three-create-an-intent",level:3},{value:"What&#39;s next",id:"whats-next",level:3},{value:"Teardown",id:"teardown",level:2}],u={toc:c},p="wrapper";function d(e){let{components:t,...l}=e;return(0,o.yg)(p,(0,a.A)({},u,l,{components:t,mdxType:"MDXLayout"}),(0,o.yg)("p",null,"This tutorial will walk you through deploying an AWS EKS cluster with the AWS VPC CNI add-on, while enabling the new network policy support on EKS with Otterize."),(0,o.yg)("h2",{id:"prerequisites"},"Prerequisites"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"An EKS cluster with the AWS VPC CNI add-on installed and with the new built-in network policy support enabled. See ",(0,o.yg)("a",{parentName:"li",href:"https://docs.aws.amazon.com/eks/latest/userguide/pod-networking.html"},"Installing the AWS VPC CNI add-on")," for more information, or follow the instructions below."),(0,o.yg)("li",{parentName:"ul"},"The ",(0,o.yg)("a",{parentName:"li",href:"/overview/installation#install-the-otterize-cli"},"Otterize CLI"),"."),(0,o.yg)("li",{parentName:"ul"},"The ",(0,o.yg)("a",{parentName:"li",href:"https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html"},"AWS CLI"),"."),(0,o.yg)("li",{parentName:"ul"},"The ",(0,o.yg)("a",{parentName:"li",href:"https://kubernetes.io/docs/tasks/tools/install-kubectl/"},"kubectl")," command-line tool.")),(0,o.yg)("h2",{id:"tutorial"},"Tutorial"),(0,o.yg)("h3",{id:"step-one-create-an-aws-eks-cluster-with-the-aws-vpc-cni-plugin"},"Step one: Create an AWS EKS cluster with the AWS VPC CNI plugin"),(0,o.yg)("p",null,"Before you start, you'll need an AWS Kubernetes cluster. Having a cluster with a ",(0,o.yg)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/extend-kubernetes/compute-storage-net/network-plugins/"},"CNI")," that supports ",(0,o.yg)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/services-networking/network-policies/"},"NetworkPolicies")," is required for this tutorial."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-shell"},"eksctl create cluster -f cluster-config.yaml\n")),(0,o.yg)("p",null,"Run the following command to create your AWS cluster. ",(0,o.yg)("a",{parentName:"p",href:"https://eksctl.io/installation/"},"Don't have eksctl? Install it now.")),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"curl ${ABSOLUTE_URL}/code-examples/aws-eks-mini/cluster-config.yaml | eksctl create cluster -f -\n")),(0,o.yg)("details",null,(0,o.yg)("summary",null,"Inspect eks-cluster.yaml contents"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: eksctl.io/v1alpha5\nkind: ClusterConfig\n\nmetadata:\n  name: np-ipv4-127\n  region: us-west-2\n  version: "1.27"\n\niam:\n  withOIDC: true\n\nvpc:\n  clusterEndpoints:\n    publicAccess: true\n    privateAccess: true\n\naddons:\n  - name: vpc-cni\n    version: 1.14.0\n    attachPolicyARNs: #optional\n      - arn:aws:iam::aws:policy/AmazonEKS_CNI_Policy\n    configurationValues: |-\n      # highlight-next-line\n      enableNetworkPolicy: "true"\n  - name: coredns\n  - name: kube-proxy\n\nmanagedNodeGroups:\n  - name: small-on-demand\n    amiFamily: AmazonLinux2\n    instanceTypes: [ "t3.large" ]\n    minSize: 0\n    desiredCapacity: 2\n    maxSize: 6\n    privateNetworking: true\n    disableIMDSv1: true\n    volumeSize: 100\n    volumeType: gp3\n    volumeEncrypted: true\n    tags:\n      team: "eks"\n'))),(0,o.yg)("p",null,"Once your AWS EKS has finished deploying the control pane and node group, the next step is deploying Otterize as well as a couple of clients and a server to see how they are affected by network policies."),(0,o.yg)("h3",{id:"step-two-install-the-otterize-agents"},"Step two: Install the Otterize agents"),(0,o.yg)("h3",{id:"install-otterize-on-your-cluster"},"Install Otterize on your cluster"),(0,o.yg)("p",null,"To deploy Otterize, head over to ",(0,o.yg)("a",{parentName:"p",href:"https://app.otterize.com"},"Otterize Cloud")," and create a Kubernetes cluster on the ",(0,o.yg)("a",{parentName:"p",href:"https://app.otterize.com/integrations"},"Integrations page"),", and follow the instructions."),(0,o.yg)("h3",{id:"deploy-a-server-and-two-clients"},"Deploy a server and two clients"),(0,o.yg)("p",null,"So that we have some pods to look at (and protect), you can install our simple clients and server demo app that will deploy a server and 2 clients."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"kubectl apply -f ${ABSOLUTE_URL}/code-examples/automate-network-policies/all.yaml\n")),(0,o.yg)("p",null,"Once you have that installed and running your Otterize access graph should look something like this:"),(0,o.yg)("p",null,(0,o.yg)("img",{alt:"Access Graph",src:n(730).A,width:"4272",height:"2666"})),(0,o.yg)("h3",{id:"step-three-create-an-intent"},"Step three: Create an intent"),(0,o.yg)("p",null,"Now that you have Otterize installed, the next step is to create an intent which will enable access to the server from the client. If you enable protection on the server without declaring an intent, the client will be blocked."),(0,o.yg)("admonition",{type:"tip"},(0,o.yg)("p",{parentName:"admonition"},"You can click on the workloads or the lines connecting them to see which ClientIntents you need to apply to make the connection go green!")),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-shell"},"otterize network-mapper export --server server.otterize-tutorial-eks | kubectl apply -f -\n")),(0,o.yg)("p",null,"Running this command will generate the following ",(0,o.yg)("inlineCode",{parentName:"p"},"ClientIntents")," for each client connected to ",(0,o.yg)("inlineCode",{parentName:"p"},"server")," and apply it to your cluster. You could also place it in a Helm chart or apply it some other way, instead of piping it directly to kubectl."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: k8s.otterize.com/v2beta1\nkind: ClientIntents\nmetadata:\n  name: client\n  namespace: otterize-tutorial-eks\nspec:\n  workload:\n    name: client\n    kind: Deployment\n  targets:\n    - service:\n        name: server\n---\napiVersion: k8s.otterize.com/v2beta1\nkind: ClientIntents\nmetadata:\n  name: client-other\n  namespace: otterize-tutorial-eks\nspec:\n  workload:\n    name: client-other\n    kind: Deployment\n  targets:\n    - service:\n        name: server\n")),(0,o.yg)("p",null,"At which point you should see that the ",(0,o.yg)("inlineCode",{parentName:"p"},"server")," workload is ready to be protected:"),(0,o.yg)("p",null,(0,o.yg)("img",{alt:"One intent applied",src:n(5564).A,width:"4272",height:"2666"})),(0,o.yg)("p",null,"And you can then protect the ",(0,o.yg)("inlineCode",{parentName:"p"},"server")," workload by applying the following ",(0,o.yg)("inlineCode",{parentName:"p"},"yaml")," file:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: k8s.otterize.com/v2beta1\nkind: ProtectedService\nmetadata:\n  name: server\n  namespace: otterize-tutorial-eks\n\nspec:\n  name: server\n  kind: Deployment\n")),(0,o.yg)("p",null,"Protect the server by applying the resource:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"kubectl apply -f ${ABSOLUTE_URL}/code-examples/aws-eks-mini/protect-server.yaml\n")),(0,o.yg)("p",null,"And you should see your access graph showing the workload as protected:"),(0,o.yg)("p",null,(0,o.yg)("img",{alt:"Protected Service",src:n(9869).A,width:"4272",height:"2666"})),(0,o.yg)("h3",{id:"whats-next"},"What's next"),(0,o.yg)("p",null,"Have a look at the ",(0,o.yg)("a",{parentName:"p",href:"/features/network-mapping-network-policies/tutorials/protect-1-service-network-policies"},"guide on how to deploy protection to a larger, more complex application one step at a time"),"."),(0,o.yg)("h2",{id:"teardown"},"Teardown"),(0,o.yg)("p",null,"To remove the deployed examples run:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"kubectl delete -f protect-server.yaml\notterize network-mapper export --server server.otterize-tutorial-eks | kubectl delete -f -\nkubectl delete -f ${ABSOLUTE_URL}/code-examples/automate-network-policies/all.yaml\nhelm uninstall otterize -n otterize-system\neksctl delete cluster -f cluster-config.yaml\n")))}d.isMDXComponent=!0},730:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/access-graph-fb7131a2b1aacade84865a7b330cf797.png"},5564:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/one-intent-5c4f754a0651dbfef4f1e012be2c767a.png"},9869:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/protected-4fda5263b360340ac9ee982cd234e4c2.png"}}]);