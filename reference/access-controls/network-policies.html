<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-reference/access-controls/network-policies/README">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Network policies deep dive | Otterize</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.otterize.com/reference/access-controls/network-policies"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Network policies deep dive | Otterize"><meta data-rh="true" name="description" content="Network policies are one of the tools we"><meta data-rh="true" property="og:description" content="Network policies are one of the tools we"><link data-rh="true" rel="icon" href="/img/favicon.svg"><link data-rh="true" rel="canonical" href="https://docs.otterize.com/reference/access-controls/network-policies"><link data-rh="true" rel="alternate" href="https://docs.otterize.com/reference/access-controls/network-policies" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.otterize.com/reference/access-controls/network-policies" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://69PZ47MO2R-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Otterize" href="/opensearch.xml">

<script>!function(t,h,e,j,s,n){t.hj=t.hj||function(){(t.hj.q=t.hj.q||[]).push(arguments)},t._hjSettings={hjid:3156902,hjsv:6},s=h.getElementsByTagName("head")[0],(n=h.createElement("script")).async=1,n.src="https://static.hotjar.com/c/hotjar-"+t._hjSettings.hjid+".js?sv="+t._hjSettings.hjsv,s.appendChild(n)}(window,document)</script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2EG876ZREF"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-2EG876ZREF",{})</script>
<script src="/newsLetterSubscription.js" async></script>
<script src="/pixels.js" async></script><link rel="stylesheet" href="/assets/css/styles.0771976d.css">
<link rel="preload" href="/assets/js/runtime~main.c9200435.js" as="script">
<link rel="preload" href="/assets/js/main.7057477e.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://otterize.com" target="_self" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/otterize-logo-light.svg" alt="Otterize" class="themedImage_ToTc themedImage--light_HNdA" style="padding-left:15px"><img src="/img/otterize-logo-light.svg" alt="Otterize" class="themedImage_ToTc themedImage--dark_i4oU" style="padding-left:15px"></div></a></div><div class="navbar__items navbar__items--right"><a href="https://otterize.com/open-source" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link">Open source<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://otterize.com/product" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link">Product<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://otterize.com/ibac" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link">IBAC<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Docs</a><a href="https://otterize.com/pricing" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link">Pricing<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://otterize.com/team" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link">Team<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://otterize.com/blog" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/otterize" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link" class="navbar_external_logo_first"><img src="/img/github-round-logo.svg"></a><a href="https://joinslack.otterize.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link" class="navbar_external_logo"><img src="/img/slack-logo-no-border.svg"></a><a href="https://app.otterize.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span class="launch_app">Launch App</span></a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Getting started</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/quick-tutorials/k8s-network-policies">Quick hands-on tutorials</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/quick-tutorials/k8s-network-policies">NetworkPolicy automation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/quick-tutorials/k8s-kafka-mtls">Simple, secure Kafka access</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/quick-tutorials/k8s-network-mapper">Kubernetes cluster mapping</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/quick-tutorials/k8s-istio-authorization-policies">Istio AuthorizationPolicy automation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/quick-tutorials/k8s-istio-watcher">Istio traffic mapping</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/quick-tutorials/k8s-mtls">Simple mTLS deployment</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/quick-visual-tutorials/visual-k8s-cluster-mapping">Quick visual tutorials</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/quick-visual-tutorials/visual-k8s-cluster-mapping">Kubernetes cluster mapping</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/quick-visual-tutorials/visual-ibac-network-policies">IBAC with network policies</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/quick-visual-tutorials/visual-ibac-kafka-k8s">IBAC for Kafka in Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/quick-visual-tutorials/visual-ibac-istio-authorization-policies">IBAC with Istio authorization policies</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/installation">Installation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/intent-based-access-control">IBAC: Intent-based access control</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/shadow-vs-active-enforcement">Shadow vs active enforcement</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/otterize-oss">Otterize OSS</a><button aria-label="Toggle the collapsible sidebar category &#x27;Otterize OSS&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/otterize-cloud">Otterize Cloud</a><button aria-label="Toggle the collapsible sidebar category &#x27;Otterize Cloud&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/reference/configuration/otterize-chart">Reference</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/reference/configuration/otterize-chart">Configuration</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/cli">CLI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/api">API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/intents-and-intents-files">Intents and intents files</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/service-identities">Service identities and resolution</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/reference/access-controls/network-policies">Access controls</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/reference/access-controls/network-policies">Network policies deep dive</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/terminology">Terminology</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/mtls">Kubernetes mTLS</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/security">Security</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/faq">FAQ</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Reference</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Access controls</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Network policies deep dive</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Network policies deep dive</h1></header><p><a href="https://kubernetes.io/docs/concepts/services-networking/network-policies/" target="_blank" rel="noopener noreferrer">Network policies</a> are one of the tools we
can use for traffic shaping within K8s clusters. They allow us to shape traffic using selectors, policies, and L3
and L4 identifiers. To enforce network policies, a Kubernetes cluster requires a CNI supporting network policies to be
installed. Some popular options are Calico and Cilium.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="closer-look-at-a-network-policy">Closer look at a network policy<a class="hash-link" href="#closer-look-at-a-network-policy" title="Direct link to heading">​</a></h2><p>Let&#x27;s take a look at an example showing a network policy allowing traffic:</p><ul><li>From pods labeled <strong>app:backend</strong> in namespaces labeled <strong>env:production</strong>.</li><li>To pods labeled <strong>app:db</strong> in the namespace  <strong>production-db</strong>.</li></ul><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token key atrule" style="color:#FAC863">apiVersion</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> networking.k8s.io/v1</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">kind</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> NetworkPolicy</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">metadata</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> allow</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">production</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">backend</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">namespace</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> production</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">db            </span><span class="token comment" style="color:#999999"># [Target filter] applies to pods in this namespace</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">spec</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">podSelector</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">matchLabels</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">app</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> db                         </span><span class="token comment" style="color:#999999"># [Target filter] applies to pods with this label</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">policyTypes</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> Ingress                         </span><span class="token comment" style="color:#999999"># [Direction] implemented as a filter on incoming connections</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">ingress</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#FAC863">from</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#FAC863">namespaceSelector</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token key atrule" style="color:#FAC863">matchLabels</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">              </span><span class="token key atrule" style="color:#FAC863">env</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> production         </span><span class="token comment" style="color:#999999"># [Source filter] applies to namespaces with this label</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#FAC863">podSelector</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token key atrule" style="color:#FAC863">matchLabels</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">              </span><span class="token key atrule" style="color:#FAC863">app</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> backend            </span><span class="token comment" style="color:#999999"># [Source filter] applies to pods with this label</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="setting-security-scope-via-default-network-policies">Setting security scope via default network policies<a class="hash-link" href="#setting-security-scope-via-default-network-policies" title="Direct link to heading">​</a></h2><p>Two common approaches for working with network policies are:</p><ul><li>Allow all traffic between pods, protect some pods by applying ingress network policies to them.</li><li>Block all traffic between pods except allowed traffic by network policies.</li></ul><p>You can apply both approaches (allow/block all) within your cluster (e.g. by applying network policies based on
namespaces).</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="default-deny-network-policy">Default deny network policy<a class="hash-link" href="#default-deny-network-policy" title="Direct link to heading">​</a></h2><p>To block all traffic within a namespace, you can apply a default deny network policy to that namespace. After applying this policy, only traffic allowed by network policies, such as those generated automatically from ClientIntents, will be allowed within that namespace.</p><p>Such a policy only blocks ingress traffic, so it does not prevent pods from connecting to the Internet. Enforcement is performed at the ingress to pods. This is appropriate for achieving in-cluster service-to-service zero trust and network segmentation within a namespace.</p><p>Here is such a policy that you can apply to any namespace:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token key atrule" style="color:#FAC863">apiVersion</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> networking.k8s.io/v1</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">kind</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> NetworkPolicy</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">metadata</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> default</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">deny</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">ingress</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">spec</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">podSelector</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">policyTypes</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> Ingress</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="global-ingress-default-deny-policy-with-calico">Global ingress default deny policy with Calico<a class="hash-link" href="#global-ingress-default-deny-policy-with-calico" title="Direct link to heading">​</a></h2><p>If using Calico as your CNI for network policies, you can deploy a global (cluster-wide, across multiple namespaces), ingress-type default deny network policy. After applying this policy, only traffic allowed by network policies, such as those generated automatically from ClientIntents, will be allowed throughout the cluster.</p><p>It&#x27;s important to exempt Otterize and Calico and the Kubernetes infrastructure itself from this policy, so they can function correctly by receiving calls from the Kubernetes API server.</p><p>Such a policy only blocks ingress traffic, so it does not prevent pods from connecting to the Internet. Enforcement is performed at the ingress to pods. This is appropriate for achieving in-cluster service-to-service zero trust and network segmentation across an entire cluster.</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token key atrule" style="color:#FAC863">apiVersion</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> projectcalico.org/v3</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">kind</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> GlobalNetworkPolicy</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">metadata</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> global</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">deny</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">ingress</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">spec</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999"># Exclude kube-system, calico-system, calico-apiserver and otterize-system</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">namespaceSelector</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> has(projectcalico.org/name) </span><span class="token important" style="font-weight:400">&amp;&amp;</span><span class="token plain"> projectcalico.org/name not in </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token string" style="color:#8dc891">&quot;kube-system&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;calico-system&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;calico-apiserver&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;otterize-system&quot;</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">types</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">  </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> Ingress </span><span class="token comment" style="color:#999999"># Ingress-only</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="tip-using-a-global-egress-default-deny-policy-with-calico">Tip: Using a global <em>egress</em> default deny policy with Calico<a class="hash-link" href="#tip-using-a-global-egress-default-deny-policy-with-calico" title="Direct link to heading">​</a></h2><p>If using Calico for network policies, you might choose to deploy a global (cluster-wide, across multiple namespaces) default <strong>egress</strong> deny network policy, in order to restrict egress traffic going out of the cluster. If so, it is important to exempt Otterize and Calico from this policy so that they are able to function correctly.
Also, note that Otterize-managed network policies only apply to traffic within the cluster.</p><p>To work well with an ingress default deny policy, an egress policy should not prevent traffic within the cluster <!-- -->—<!-- --> the global default deny ingress policy will already block all in-cluster traffic by default, and ClientIntents will then allow intended traffic.</p><p>Here is an example of how you can achieve this by explicitly allowlisting certain pod IPs. You will need to substitute the appropriate IPs for your pods. This is usually part of your CNI or cluster configuration.</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token key atrule" style="color:#FAC863">apiVersion</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> projectcalico.org/v3</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">kind</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> GlobalNetworkPolicy</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">metadata</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> default</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">deny</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">egress</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">spec</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">namespaceSelector</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> has(projectcalico.org/name) </span><span class="token important" style="font-weight:400">&amp;&amp;</span><span class="token plain"> projectcalico.org/name not in </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token string" style="color:#8dc891">&quot;kube-system&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;calico-system&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;calico-apiserver&quot;</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">types</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> Egress</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">egress</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">   </span><span class="token comment" style="color:#999999"># Allow all namespaces to communicate to DNS pods</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#FAC863">action</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> Allow</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">protocol</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> UDP</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">destination</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">selector</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;k8s-app == &quot;kube-dns&quot;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">ports</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token string" style="color:#8dc891">&quot;53&quot;</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999"># Allow all namespaces to talk to the internet on port 443</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#FAC863">action</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> Allow</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">protocol</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> TCP</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">destination</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">nets</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token string" style="color:#8dc891">&quot;0.0.0.0/0&quot;</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">ports</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token string" style="color:#8dc891">&quot;443&quot;</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999"># Allow all namespaces to talk on egress to any port inside the cluster or in the VPC.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999"># Effectively, ingress default deny would still block any intra-cluster traffic</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999"># not explicitly allowed by a dedicated network policy.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#FAC863">action</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> Allow</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">protocol</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> TCP</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">destination</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999"># update these IP addresses to match your pods</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">nets</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token string" style="color:#8dc891">&quot;10.0.0.0/16&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token string" style="color:#8dc891">&quot;172.20.0.0/16&quot;</span><span class="token punctuation" style="color:#8dc891">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="working-with-third-party-helm-charts-and-a-default-deny-policy">Working with third-party Helm charts and a default deny policy<a class="hash-link" href="#working-with-third-party-helm-charts-and-a-default-deny-policy" title="Direct link to heading">​</a></h2><p>After applying a default deny policy, you will need network policies for intended traffic to go through.
The Otterize network mapper generates ClientIntents for your cluster, but we recommend you use ClientIntents for services that are functional clients, rather than purely operational infrastructure (e.g. <code>checkoutservice</code> is a client, while Prometheus is purely operational infrastructure). So you will need to enable traffic to/from such infrastructure outside of Otterize.</p><p>Many third-party Helm charts come with a ready-made network policy to use when deployed into a cluster that uses a default deny policy. Simply enable them using the values found in the chart.</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>We recommend using these explicit network policies rather than ClientIntents, as this relieves the infrastructure or platform team in your organization from maintaining ClientIntents for infrastructure services: instead, the Helm chart will always have the most accurate infrastructural network policies.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="auto-generating-network-policies-for-external-traffic">Auto-generating network policies for external traffic<a class="hash-link" href="#auto-generating-network-policies-for-external-traffic" title="Direct link to heading">​</a></h2><p>The intents operator defaults to automatically generate network policies for Kubernetes <strong>Services</strong> (type <strong>LoadBalancer</strong> and <strong>NodePort</strong>), and Ingress traffic
when an intent will generate a network policy that can block external traffic. To disable this feature, consult the <a href="/reference/configuration/intents-operator">documentation for the intents operator</a>.</p><p>Let&#x27;s look at an example from our demo. We have a <strong>frontend</strong> service being accessed from multiple sources:</p><ul><li><strong>loadgenerator</strong> calls it from within the cluster to generate traffic, by accessing the <strong>frontend</strong> <strong>ClusterIP Service</strong>.</li><li><strong>frontend-external</strong> is a <strong>Service</strong> with type <strong>LoadBalancer</strong> directing traffic from outside the cluster to the frontend pods. The <strong>LoadBalancer</strong> type means that a cloud provider load balancer will be created and point traffic from the Internet to these pods.</li></ul><p>By applying the following intents file:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token key atrule" style="color:#FAC863">apiVersion</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> k8s.otterize.com/v1alpha2</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">kind</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> ClientIntents</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">metadata</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> loadgenerator</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">spec</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">service</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> loadgenerator</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">calls</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#FAC863">name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> frontend</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Otterize will generate a network policy allowing access from the <strong>loadgenerator</strong> service to the <strong>frontend</strong> service.
Once a single network policy matches a pod, other traffic not allowed by existing network policies to the <strong>frontend</strong> will get blocked. In our
case that means that the <strong>frontend-external</strong> <strong>LoadBalancer</strong> won&#x27;t be able to communicate with <strong>frontend</strong>.</p><p>To overcome this, Otterize will automatically generate a network policy to allow traffic from <strong>frontend-external</strong>
to <strong>frontend</strong> by relying on the existence of the <strong>LoadBalancer Service</strong> as an indicator of intent between the two.</p><p>Why doesn&#x27;t Otterize always generate network policies for ingress types?
Because if no network policies exist, automatically generating a network policy to allow <strong>frontend-external</strong> -&gt; <strong>frontend</strong>
would block existing traffic like <strong>loadgenerator</strong> -&gt; <strong>frontend</strong>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-intents-translate-to-network-policies">How intents translate to network policies<a class="hash-link" href="#how-intents-translate-to-network-policies" title="Direct link to heading">​</a></h2><p>Let&#x27;s follow an example scenario and track how Otterize configures network policies when we apply intents.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-example">Deploy example<a class="hash-link" href="#deploy-example" title="Direct link to heading">​</a></h3><p>Our example consists of two pods: an HTTP server and a client that calls it.</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Expand to see the example YAML files</summary><div><div class="collapsibleContent_i85q"><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">namespace.yaml</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">server.yaml</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">client.yaml</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">&gt;</span><span class="token plain"> include file not found</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> ../../../static/code</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">examples/automate</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">network</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">policies/namespace.yaml </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token punctuation" style="color:#8dc891">&gt;</span><span class="token plain"> /home/runner/work/docs/docs/docs/static/code</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">examples/automate</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">network</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">policies/namespace.yaml</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">&gt;</span><span class="token plain"> include file not found</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> ../../../static/code</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">examples/automate</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">network</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">policies/server</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">deployment.yaml </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token punctuation" style="color:#8dc891">&gt;</span><span class="token plain"> /home/runner/work/docs/docs/docs/static/code</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">examples/automate</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">network</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">policies/server</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">deployment.yaml</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">&gt;</span><span class="token plain"> include file not found</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> ../../../static/code</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">examples/automate</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">network</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">policies/server</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">service.yaml </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token punctuation" style="color:#8dc891">&gt;</span><span class="token plain"> /home/runner/work/docs/docs/docs/static/code</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">examples/automate</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">network</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">policies/server</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">service.yaml</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">&gt;</span><span class="token plain"> include file not found</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> ../../../static/code</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">examples/automate</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">network</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">policies/client</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">deployment.yaml </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token punctuation" style="color:#8dc891">&gt;</span><span class="token plain"> /home/runner/work/docs/docs/docs/static/code</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">examples/automate</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">network</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">policies/client</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">deployment.yaml</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div></div></div></details><ol><li><p>Deploy the <strong>client</strong> and <strong>server</strong> using <code>kubectl</code>:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">kubectl apply -f https://docs.otterize.com/code-examples/automate-network-policies/all.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Check that the <strong>client</strong> and <strong>server</strong> pods were deployed:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">kubectl get pods -n otterize-tutorial-npol</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You should see:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">NAME                      READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">client-5689997b5c-grlnt   1/1     Running   0          35s</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">server-6698c58cbc-v9n9b   1/1     Running   0          34s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>The <strong>client</strong> intents to call the server are declared with this <code>intents.yaml</code> file:</p></li></ol><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">&gt;</span><span class="token plain"> include file not found</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> ../../../static/code</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">examples/automate</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">network</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">policies/intents.yaml </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token punctuation" style="color:#8dc891">&gt;</span><span class="token plain"> /home/runner/work/docs/docs/docs/static/code</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">examples/automate</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">network</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">policies/intents.yaml</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>   Let&#x27;s apply it:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">kubectl apply -f https://docs.otterize.com/code-examples/automate-network-policies/intents.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="track-artifacts">Track artifacts<a class="hash-link" href="#track-artifacts" title="Direct link to heading">​</a></h3><p>After applying the intents file Otterize performed multiple actions to allow access from the client to the server using network policies:</p><ul><li>Create a network policy allowing traffic from the <!-- -->[client, namespace -labeled]<!-- --> pods to <!-- -->[server-labeled]<!-- --> pods</li><li>Label the client pods</li><li>Label the client pod namespaces</li><li>Label the server pods</li></ul><ol><li><p>Let&#x27;s look at the generated network policy:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">kubectl describe networkpolicies -n otterize-tutorial-npol access-to-server-from-otterize-tutorial-npol</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You should see (without the comments):</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token key atrule" style="color:#FAC863">Name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain">         access</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">to</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">server</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">from</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">otterize</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">tutorial</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">npol</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999"># [Target filter] namespace</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">Namespace</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain">    otterize</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">tutorial</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">npol</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">Created on</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain">   2022</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">09</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">08 19</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain">12</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain">24 +0300 IDT</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">Labels</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain">       intents.otterize.com/network</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">policy=true</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">Annotations</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain">  &lt;none</span><span class="token punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">Spec</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999"># [Target filter] pods with this label</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">PodSelector</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain">     intents.otterize.com/server=server</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">otterize</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">tutorial</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">np</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">7e16db</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">Allowing ingress traffic</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">To Port</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> &lt;any</span><span class="token punctuation" style="color:#8dc891">&gt;</span><span class="token plain"> (traffic allowed to all ports)</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">From</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token comment" style="color:#999999"># [Source filter] namespaces with this label</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">NamespaceSelector</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> intents.otterize.com/namespace</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">name=otterize</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">tutorial</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">npol</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token comment" style="color:#999999"># [Source filter] pods with this label</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">PodSelector</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> intents.otterize.com/access</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">server</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">otterize</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">tutorial</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">np</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">7e16db=true</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  Not affecting egress traffic</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999"># [Direction]</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">Policy Types</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> Ingress</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>And we can also see that the client and server pods are now labeled:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">kubectl get pods -n otterize-tutorial-npol --show-labels</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You should see:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">NAME                      READY   STATUS    RESTARTS   AGE     LABELS</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">client-5cb67b748-l25vg    </span><span class="token number" style="color:#5a9bcf">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#5a9bcf">0</span><span class="token plain">          7m57s   intents.otterize.com/access-server-otterize-tutorial-np-7e16db</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">true,intents.otterize.com/client</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">true,intents.otterize.com/server</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">client-otterize-tutorial-np-699302,pod-template-hash</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">5cb67b748,credentials-operator.otterize.com/service-name</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">client</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">server-564b56f596-54str   </span><span class="token number" style="color:#5a9bcf">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#5a9bcf">0</span><span class="token plain">          7m56s   intents.otterize.com/server</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">server-otterize-tutorial-np-7e16db,pod-template-hash</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">564b56f596,credentials-operator.otterize.com/service-name</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">server</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When we break down the label structure we can see:</p></li></ol><ul><li>For the server - <span style="color:gray">intents.otterize.com/server</span>=<span style="color:magenta">server</span>-<span style="color:red">otterize-tutorial-np</span>-<span style="color:green">7e16db</span><ul><li><span style="color:gray">intents.otterize.com/server</span> - Label prefix for servers</li><li><span style="color:magenta">server</span> - Server pod name</li><li><span style="color:red">otterize-tutorial-np</span> - Server pod namespace (might be truncated)</li><li><span style="color:green">7e16db</span> - Hash for server pod name and and namespace</li></ul></li><li>For the client - <span style="color:gray">intents.otterize.com/access</span>-<span style="color:magenta">server</span>-<span style="color:red">otterize-tutorial-np</span>-<span style="color:green">7e16db</span>=true<ul><li><span style="color:gray">intents.otterize.com/access</span> - Label prefix for clients</li><li><span style="color:magenta">server</span> - Server pod name</li><li><span style="color:red">otterize-tutorial-np</span> - Server pod namespace (might be truncated)</li><li><span style="color:green">7e16db</span> - Hash for server pod name and and namespace</li></ul></li></ul><ol start="3"><li>Finally, let&#x27;s look at the namespace label with:<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">kubectl get namespace otterize-tutorial-npol --show-labels</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>  You should see:<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">NAME                     STATUS   AGE   LABELS</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">otterize-tutorial-npol   Active   36s   intents.otterize.com/namespace-name</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">otterize-tutorial-npol,kubernetes.io/metadata.name</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">otterize-tutorial-npol</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>  With the new label added by Otterize - <strong>intents.otterize.com/namespace-name=otterize-tutorial-npol</strong></li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/otterize/docs/edit/main/docs/reference/access-controls/network-policies/README.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/reference/service-identities"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Service identities and resolution</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/reference/terminology"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Terminology</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#closer-look-at-a-network-policy" class="table-of-contents__link toc-highlight">Closer look at a network policy</a></li><li><a href="#setting-security-scope-via-default-network-policies" class="table-of-contents__link toc-highlight">Setting security scope via default network policies</a></li><li><a href="#default-deny-network-policy" class="table-of-contents__link toc-highlight">Default deny network policy</a></li><li><a href="#global-ingress-default-deny-policy-with-calico" class="table-of-contents__link toc-highlight">Global ingress default deny policy with Calico</a></li><li><a href="#tip-using-a-global-egress-default-deny-policy-with-calico" class="table-of-contents__link toc-highlight">Tip: Using a global <em>egress</em> default deny policy with Calico</a></li><li><a href="#working-with-third-party-helm-charts-and-a-default-deny-policy" class="table-of-contents__link toc-highlight">Working with third-party Helm charts and a default deny policy</a></li><li><a href="#auto-generating-network-policies-for-external-traffic" class="table-of-contents__link toc-highlight">Auto-generating network policies for external traffic</a></li><li><a href="#how-intents-translate-to-network-policies" class="table-of-contents__link toc-highlight">How intents translate to network policies</a><ul><li><a href="#deploy-example" class="table-of-contents__link toc-highlight">Deploy example</a></li><li><a href="#track-artifacts" class="table-of-contents__link toc-highlight">Track artifacts</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__links text--center"><div class="footer__links"><span class="footer__link-item">
                <div class="footer_left">

                    <div id="mailchimp_title" class="footer_signup">
                        Sign up for updates
                    </div>
                    <div class="footer_left-links">
                        <form id="mailchimp_form" class="footer_signup-form" name="embedded-subscribe-form">
                            <input id="mailchimp_email_input" style="color: white" type="email" name="EMAIL" class="footer_signup-input" placeholder="Email address" required="">
                            <button id="mailchimp_cta" type="submit" class="footer_signup-button">
                                <img src="/img/arrow_right_alt.svg" alt="Right arrow icon" class="footer_signup-img">
                            </button>
                        </form>
                    </div>
                </div>
                </span><span class="footer__link-separator">·</span><span class="footer__link-item"><div class="footer_right">
                            <div class="footer_privacy-policy">
                                <a href="https://otterize.com/privacy">privacy policy</a>
                            </div>
                            <div class="footer_right-links">
                                <a href="https://github.com/otterize/"><img src="/img/github-icon.svg"></a>
                                <a href="https://www.linkedin.com/company/otterize"><img src="/img/linkedin-icon.svg"></a>
                                <a href="https://joinslack.otterize.com/"><img src="/img/slack-icon.svg"></a>
                            </div>
                         </div></span><span class="footer__link-separator">·</span><span class="footer__link-item"><div class="footer_copyright">
                            Built with Docusaurus
                            <p>
                            © 2023 Otterize, Inc. All rights reserved.
                        </div></span></div></div></div></footer></div>
<script src="/assets/js/runtime~main.c9200435.js"></script>
<script src="/assets/js/main.7057477e.js"></script>
</body>
</html>