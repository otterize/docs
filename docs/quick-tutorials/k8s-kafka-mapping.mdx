---
sidebar_position: 6
title: Kafka topic level access mapping
---
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import styles from '/src/css/styles.module.css';

With its Kafka watcher enabled, the network mapper allows you to map topic level access to Kafka servers within your K8s cluster.
This provides a clear picture of which Kafka topics are being accessed and with what operations.
In this tutorial, we will:

- Deploy a Kafka broker, and three clients that call it.
- Discover which topics are being accessed by those clients, and with what operations, using the Otterize network mapper's Kafka watcher.

## Prerequisites

<details>
<summary>Prepare a Kubernetes cluster</summary>

Before you start, you'll need a Kubernetes cluster. Having a cluster with a [CNI](https://kubernetes.io/docs/concepts/extend-kubernetes/compute-storage-net/network-plugins/) that supports [NetworkPolicies](https://kubernetes.io/docs/concepts/services-networking/network-policies/) isn't required for this tutorial, but is recommended so that your cluster works with other tutorials.

{@include: ../_common/cluster-setup.md}
</details>

You can now install Otterize in your cluster, and optionally connect to Otterize Cloud. Connecting to Cloud lets you
see what's happening visually in your browser, through the "access graph".

So either forego browser visualization and:

<details>
<summary>Install Otterize in your cluster with the Kafka watcher component enabled, <b>without</b> Otterize Cloud</summary>

```
helm repo add otterize https://helm.otterize.com
helm repo update
helm install otterize otterize/otterize-kubernetes -n otterize-system --create-namespace \
--set networkMapper.kafkawatcher.enable=true \
--set networkMapper.kafkawatcher.kafkaServers={"kafka-0.kafka"}
```

</details>

Or choose to include browser visualization and:

<details>
<summary>Install Otterize in your cluster, <b>with</b> Otterize Cloud</summary>

####  Create an Otterize Cloud account

{@include: ../_common/create-account.md}

#### Install Otterize OSS, connected to Otterize Cloud

{@include: ../_common/install-otterize-from-cloud-with-enforcement-and-kafka-watcher.md}

</details>

Finally, you'll need to install the Otterize CLI (if you haven't already) to interact with the network mapper:

<details>
<summary>Install the Otterize CLI</summary>

{@include: ../_common/install-otterize-cli.md}

</details>

## Install Kafka

We will deploy a Kafka cluster using Bitnami's [Helm chart](https://github.com/bitnami/charts/tree/master/bitnami/kafka).
In the chart we will configure Kafka to:
- Recognize the Otterize intents operator as a super user so it can configure ACLs;
- Turn on Kafka debug logging to allow the Kafka watcher to feed topic-level client access information to the network mapper;

<details>
<summary>Expand to see the Helm values.yaml used with the Bitnami chart</summary>

```yaml
{@include: ../../static/code-examples/kafka-mtls/helm/values_mapping.yaml}
```
</details>

## Deploy demo to simulate traffic

Let's add services and traffic to the cluster and see how the network mapper builds the map.
Deploy the following simple example &mdash; `client`, `client2` and `nginx`, communicating over HTTP:
```shell
kubectl apply -n otterize-tutorial-istio-mapping -f https://docs.otterize.com/code-examples/network-mapper/istio.yaml
```
