<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-features/aws-iam/tutorials/aws-iam-eks" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Automate AWS IAM for EKS | Otterize</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.otterize.com/features/aws-iam/tutorials/aws-iam-eks"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Automate AWS IAM for EKS | Otterize"><meta data-rh="true" name="description" content="Otterize automates AWS IAM roles and policies for your AWS EKS workloads, all in Kubernetes."><meta data-rh="true" property="og:description" content="Otterize automates AWS IAM roles and policies for your AWS EKS workloads, all in Kubernetes."><meta data-rh="true" property="og:image" content="https://docs.otterize.com/img/quick-tutorials/aws-iam-eks/social.png"><meta data-rh="true" name="twitter:image" content="https://docs.otterize.com/img/quick-tutorials/aws-iam-eks/social.png"><link data-rh="true" rel="icon" href="/img/favicon.svg"><link data-rh="true" rel="canonical" href="https://docs.otterize.com/features/aws-iam/tutorials/aws-iam-eks"><link data-rh="true" rel="alternate" href="https://docs.otterize.com/features/aws-iam/tutorials/aws-iam-eks" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.otterize.com/features/aws-iam/tutorials/aws-iam-eks" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://69PZ47MO2R-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Otterize" href="/opensearch.xml">


<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2EG876ZREF"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-2EG876ZREF",{})</script>

<script src="/newsLetterSubscription.js" async></script>
<script src="/ui.js" async></script>
<script src="/pixels.js" async></script><link rel="stylesheet" href="/assets/css/styles.3ecefdce.css">
<link rel="preload" href="/assets/js/runtime~main.f7bd300b.js" as="script">
<link rel="preload" href="/assets/js/main.ec6cc63b.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://otterize.com" target="_self" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/otterize-logo-light.svg" alt="Otterize" class="themedImage_ToTc themedImage--light_HNdA" style="padding-left:15px"><img src="/img/otterize-logo-light.svg" alt="Otterize" class="themedImage_ToTc themedImage--dark_i4oU" style="padding-left:15px"></div></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><div id="platform-navbar-item" class="tw-flex tw-font-normal tw-text-base tw-group">Platform<div class="tw-flex"><img src="/img/menu/chevron-down.svg" class="group-hover:tw-hidden"><img src="/img/menu/chevron-up.svg" class="tw-hidden group-hover:tw-block"></div></div></a><ul class="dropdown__menu"><li><a href="https://otterize.com/open-source" target="_self" rel="noopener noreferrer" class="dropdown__link">
<div class="tw-flex tw-px-3 tw-items-start tw-gap-4 tw-self-stretch tw-rounded-xl">
<img class="tw-h-6" src="/img/menu/open-source-menu.svg">
<div class="tw-flex tw-flex-col tw-items-start tw-gap-2 lg:tw-max-w-[270px] tw-pr-3">
  <div class="tw-text-gray-900 tw-font-semibold tw-text-base">Open Source</div>
  <p class="tw-text-gray-600 tw-whitespace-pre-wrap	tw-min-w-[225px] tw-mb-0">Explore, contribute, and strengthen security with Otterize OSS.</p>
</div>
</div>
</a></li><li><a href="https://otterize.com/cloud" target="_self" rel="noopener noreferrer" class="dropdown__link">
<div class="tw-flex tw-px-3 tw-items-start tw-gap-4 tw-self-stretch tw-rounded-xl">
<img class="tw-h-6" src="/img/menu/cloud-menu.svg">
<div class="tw-flex tw-flex-col tw-items-start tw-gap-2 lg:tw-max-w-[270px] tw-pr-3">
  <div class="tw-text-gray-900 tw-font-semibold tw-text-base">Otterize Cloud</div>
  <p class="tw-text-gray-600 tw-whitespace-pre-wrap	tw-min-w-[225px] tw-mb-0">Secure your infrastructure, your way! Eliminate the need to struggle with network policies, Kafka ACLs, certificates, and IAM.</p>
</div>
</div>
</a></li></ul></div><a href="https://docs.otterize.com/" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link"><div class="tw-inline tw-font-normal tw-text-base">Documentation</div></a><a href="https://www.otterize.com/pricing" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link"><div class="tw-inline tw-font-normal tw-text-base">Pricing</div></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><div id="learn-navbar-item" class="tw-flex tw-font-normal tw-text-base tw-group">Learn<div class="tw-flex"><img src="/img/menu/chevron-down.svg" class="group-hover:tw-hidden"><img src="/img/menu/chevron-up.svg" class="tw-hidden group-hover:tw-block"></div></div></a><ul class="dropdown__menu"><li><a href="https://otterize.com/blog" target="_self" rel="noopener noreferrer" class="dropdown__link">
<div class="tw-flex tw-px-3 tw-items-start tw-gap-4 tw-self-stretch tw-rounded-xl">
<img class="tw-h-6" src="/img/menu/blog-menu.svg">
<div class="tw-flex tw-flex-col tw-items-start tw-gap-2 lg:tw-max-w-[270px] tw-pr-3">
  <div class="tw-text-gray-900 tw-font-semibold tw-text-base">Blog</div>
  <p class="tw-text-gray-600 tw-whitespace-pre-wrap	tw-min-w-[225px] tw-mb-0"></p>
</div>
</div>
</a></li><li><a href="https://otterize.com/resources" target="_self" rel="noopener noreferrer" class="dropdown__link">
<div class="tw-flex tw-px-3 tw-items-start tw-gap-4 tw-self-stretch tw-rounded-xl">
<img class="tw-h-6" src="/img/menu/resources-menu.svg">
<div class="tw-flex tw-flex-col tw-items-start tw-gap-2 lg:tw-max-w-[270px] tw-pr-3">
  <div class="tw-text-gray-900 tw-font-semibold tw-text-base">The Otter's Den</div>
  <p class="tw-text-gray-600 tw-whitespace-pre-wrap	tw-min-w-[225px] tw-mb-0">Your go-to resource hub for Kubernetes security and tech know-how.</p>
</div>
</div>
</a></li><li><a href="https://otterize.com/team" target="_self" rel="noopener noreferrer" class="dropdown__link">
<div class="tw-flex tw-px-3 tw-items-start tw-gap-4 tw-self-stretch tw-rounded-xl">
<img class="tw-h-6" src="/img/menu/philosophy-menu.svg">
<div class="tw-flex tw-flex-col tw-items-start tw-gap-2 lg:tw-max-w-[270px] tw-pr-3">
  <div class="tw-text-gray-900 tw-font-semibold tw-text-base">Our Story</div>
  <p class="tw-text-gray-600 tw-whitespace-pre-wrap	tw-min-w-[225px] tw-mb-0">Dive into our companyâ€™s mission, our philosophy, and the team that makes it all possible.</p>
</div>
</div>
</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://app.otterize.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><div id="login-link" classname="tw-inline-flex tw-h-11 tw-w-24 tw-items-center tw-justify-center tw-gap-2 tw-rounded-lg tw-px-4 tw-py-2.5 tw-text-sm lg:tw-text-base tw-font-semibold tw-leading-normal tw-text-gray-600 tw-no-underline -tw-mr-10">Log in</div></a><a href="https://otterize.com/signup" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><button class="tw-cursor-pointer tw-inline-flex tw-items-center tw-justify-center tw-gap-2 tw-rounded-xl tw-bg-gradient-to-b tw-px-3 tw-py-2.5 tw-text-sm lg:tw-text-base tw-font-semibold tw-leading-normal tw-no-underline tw-shadow tw-font-sans -tw-mr-2 tw-from-indigo-500 tw-bg-indigo-500 tw-to-indigo-600 tw-h-11 tw-border-none tw-text-white tw-w-full"><img src="/img/menu/cloud.svg">Signup <span id="sign-extended-text">for free<span></span></span></button></a><a href="https://otterize.com/book-demo" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><div class="tw-cursor-pointer tw-font-sans tw-flex tw-items-center tw-rounded-xl tw-h-11 tw-border tw-border-solid tw-border-gray-300 tw-bg-white tw-px-3 tw-text-gray-900 tw-shadow tw-font-medium tw-text-sm lg:tw-text-base tw-w-full tw-justify-center"><span id="request-demo-full-text">Request a demo</span><span id="request-demo-partial-text">Demo</span><img class="tw-ml-2" src="/img/menu/right-arrow.svg"></div></a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Getting started</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/overview">Overview</a><button aria-label="Toggle the collapsible sidebar category &#x27;Overview&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/features">Features</a><button aria-label="Toggle the collapsible sidebar category &#x27;Features&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/features/network-mapping-network-policies">Network mapping &amp; network policies</a><button aria-label="Toggle the collapsible sidebar category &#x27;Network mapping &amp; network policies&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/features/aws-iam">AWS IAM</a><button aria-label="Toggle the collapsible sidebar category &#x27;AWS IAM&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/features/aws-iam/tutorials/aws-iam-eks">Tutorials</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/features/aws-iam/tutorials/aws-iam-eks">Automate AWS IAM for EKS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/features/aws-iam/tutorials/aws-visibility">AWS resource mapping &amp; IAM policy generation</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/features/aws-iam/reference">Reference</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/features/azure-iam">Microsoft Azure IAM</a><button aria-label="Toggle the collapsible sidebar category &#x27;Microsoft Azure IAM&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/features/gcp-iam">Google Cloud IAM</a><button aria-label="Toggle the collapsible sidebar category &#x27;Google Cloud IAM&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/features/kafka">Kafka</a><button aria-label="Toggle the collapsible sidebar category &#x27;Kafka&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/features/istio">Istio</a><button aria-label="Toggle the collapsible sidebar category &#x27;Istio&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/features/postgresql">PostgreSQL</a><button aria-label="Toggle the collapsible sidebar category &#x27;PostgreSQL&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/reference/configuration/otterize-chart">Reference</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/security">Security</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/faq">FAQ</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/features"><span itemprop="name">Features</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/features/aws-iam"><span itemprop="name">AWS IAM</span></a><meta itemprop="position" content="2"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Tutorials</span><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Automate AWS IAM for EKS</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Automate AWS IAM for EKS</h1></header><p>Otterize automates AWS IAM roles and policies for your AWS EKS workloads, all in Kubernetes.</p><p>In this tutorial, we will:</p><ul><li>Optionally, spin up an EKS cluster.</li><li>Deploy a server pod that uploads files to S3, and a client pod that submits files to the server app.</li><li>Label the server pod, telling the credentials operator to link its Kubernetes ServiceAccount with an AWS IAM role created for it, such that AWS IRSA can recognize the pod.</li><li>Create a <code>ClientIntents</code> resource allowing the server pod to upload to S3, that tells the intents operator to update the previously-created role&#x27;s policy.</li><li>See that the files have been uploaded successfully.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">â€‹</a></h2><p>Already have Otterize deployed with the IAM integration configured on your cluster? <a href="#tutorial">Skip to the tutorial.</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-create-an-aws-eks-cluster">1. Create an AWS EKS cluster<a href="#1-create-an-aws-eks-cluster" class="hash-link" aria-label="Direct link to 1. Create an AWS EKS cluster" title="Direct link to 1. Create an AWS EKS cluster">â€‹</a></h3><p>Before you start, you&#x27;ll need an AWS EKS cluster. Any cluster will do; there are no special requirements or setup.</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>How to set up an AWS EKS cluster using eksctl</summary><div><div class="collapsibleContent_i85q"><p>Run the following command to create your AWS cluster. <a href="https://eksctl.io/installation/" target="_blank" rel="noopener noreferrer">Don&#x27;t have eksctl? Install it now.</a></p><div class="language-bash codeBlockContainer_APcc theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-bash codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#ffffff"><span class="token function" style="color:#79b6f2">curl</span><span class="token plain"> https://docs.otterize.com/code-examples/aws-iam-eks/cluster-config.yaml </span><span class="token operator" style="color:#d7deea">|</span><span class="token plain"> eksctl create cluster -f -</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Inspect eks-cluster.yaml contents</summary><div><div class="collapsibleContent_i85q"><div class="language-yaml codeBlockContainer_APcc theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-yaml codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#ffffff"><span class="token key atrule" style="color:#FAC863">apiVersion</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> eksctl.io/v1alpha5</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">kind</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> ClusterConfig</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">metadata</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> otterize</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">iam</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">eks</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">tutorial</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">region</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> us</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">west</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token number" style="color:#5a9bcf">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">version</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;1.27&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">iam</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">withOIDC</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#ff8b50;font-weight:400">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">vpc</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">clusterEndpoints</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">publicAccess</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#ff8b50;font-weight:400">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">privateAccess</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#ff8b50;font-weight:400">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">addons</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#FAC863">name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> vpc</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">cni</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">version</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> 1.14.0</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">attachPolicyARNs</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token comment" style="color:#999999">#optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> arn</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain">aws</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain">iam</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain">aws</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain">policy/AmazonEKS_CNI_Policy</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">configurationValues</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">|</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">enableNetworkPolicy</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;true&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#FAC863">name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> coredns</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#FAC863">name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> kube</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">proxy</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">managedNodeGroups</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#FAC863">name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> small</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">on</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">demand</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">amiFamily</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> AmazonLinux2</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">instanceTypes</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;t3.large&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">minSize</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">desiredCapacity</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">maxSize</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">privateNetworking</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#ff8b50;font-weight:400">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">disableIMDSv1</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#ff8b50;font-weight:400">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">volumeSize</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">volumeType</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> gp3</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">volumeEncrypted</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#ff8b50;font-weight:400">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">tags</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">team</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;eks&quot;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details></div></div></details><p>Don&#x27;t forget to configure your kubeconfig for your cluster. If using the example cluster above, use this command:</p><div class="language-bash codeBlockContainer_APcc theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-bash codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#ffffff"><span class="token plain">aws eks update-kubeconfig --region us-west-2 --name otterize-iam-eks-tutorial</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-deploy-otterize-for-aws-iam">2. Deploy Otterize for AWS IAM<a href="#2-deploy-otterize-for-aws-iam" class="hash-link" aria-label="Direct link to 2. Deploy Otterize for AWS IAM" title="Direct link to 2. Deploy Otterize for AWS IAM">â€‹</a></h3><p>To deploy Otterize, head over to <a href="https://app.otterize.com" target="_blank" rel="noopener noreferrer">Otterize Cloud</a> and:</p><ol><li><p>Create a Kubernetes cluster on the <a href="https://app.otterize.com/integrations" target="_blank" rel="noopener noreferrer">Integrations page</a>, and follow the instructions. <em>Make sure to enable enforcement mode for this tutorial.</em> If you already have a Kubernetes cluster connected, skip this step.</p></li><li><p>Create an AWS IAM integration on the <a href="https://app.otterize.com/integrations" target="_blank" rel="noopener noreferrer">Integrations page</a>.</p></li></ol><p>If you are using the cluster from the previous step, the cluster name is <code>otterize-iam-eks-tutorial</code> and the region is <code>us-west-2</code>.</p><p>Once the AWS integration is configured, you&#x27;ll be presented with a dialog to launch a CloudFormation template to configure the IAM roles for the Otterize operators.
This enables the operators to manage IAM for the pods in your cluster, and configures AWS IRSA on your cluster, if it is not yet configured.
This setup is required once per-cluster. <a href="https://github.com/otterize/setup/blob/main/aws-iam-operator-setup-template.yaml" target="_blank" rel="noopener noreferrer">This template can be found on GitHub as well</a>.</p><p>After CloudFormation has configured your cluster, click Next and you&#x27;ll be presented with the configuration for deploying Otterize. Since you now have the AWS integration enabled, you need to redeploy Otterize with the credentials operator enabled, and with configuration telling the operators which AWS roles they will AssumeRole to in order to operate.</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>See how to manually configure AWS IRSA on your cluster for Otterize</summary><div><div class="collapsibleContent_i85q"><p>You may also manually configure your cluster.</p><ol><li><p><a href="https://docs.aws.amazon.com/emr/latest/EMR-on-EKS-DevelopmentGuide/setting-up-enable-IAM.html" target="_blank" rel="noopener noreferrer">Configure AWS IRSA on your cluster according to the official instructions from AWS.</a></p></li><li><p>Create IAM roles for the intents operator and credentials operator.</p><ol><li>Create two roles, named &#x27;<!-- -->[your-cluster-name]<!-- -->-otterize-intents-operator&#x27; and &#x27;<!-- -->[your-cluster-name]<!-- -->-otterize-credentials-operator&#x27;.</li><li>Each of them should have a trust relationship with the intents-operator and credentials-operator service accounts on your cluster, and federated with your OpenIDConnect provider for the cluster.
Here&#x27;s an example:</li></ol><div class="language-json codeBlockContainer_APcc theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-json codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#ffffff"><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">&quot;Version&quot;</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;2012-10-17&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">&quot;Statement&quot;</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">&quot;Effect&quot;</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;Allow&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">&quot;Principal&quot;</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token property" style="color:#5a9bcf">&quot;Federated&quot;</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;arn:aws:iam::353146681200:oidc-provider/oidc.eks.us-west-2.amazonaws.com/id/C90DC306FCDDFFD362B58B0D28D844CB&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">&quot;Action&quot;</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;sts:AssumeRoleWithWebIdentity&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">&quot;Condition&quot;</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token property" style="color:#5a9bcf">&quot;StringEquals&quot;</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                </span><span class="token property" style="color:#5a9bcf">&quot;oidc.eks.us-west-2.amazonaws.com/id/C90DC306FCDDFFD362B58B0D28D844CB:sub&quot;</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;system:serviceaccount:otterize-system:intents-operator-controller-manager&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><p>In this example, <code>C90DC306FCDDFFD362B58B0D28D844CB</code> is your OpenIDConnect provider ID.
For the <code>credentials-operator</code>, substitute <code>system:serviceaccount:otterize-system:intents-operator-controller-manager</code> with <code>system:serviceaccount:otterize-system:credentials-operator-controller-manager</code>.</p><ol start="3"><li>Create IAM policies for these two roles.
They should grant access to all <code>iam</code> permissions in the account, and a subset of <code>organizations</code> and <code>ec2</code> and <code>eks</code> permissions. Here&#x27;s an example:</li></ol><div class="language-yaml codeBlockContainer_APcc theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-yaml codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">Statement</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#FAC863">Effect</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> Allow</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">Action</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;iam:*&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;organizations:DescribeAccount&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;organizations:DescribeOrganization&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;organizations:DescribeOrganizationalUnit&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;organizations:DescribePolicy&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;organizations:ListChildren&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;organizations:ListParents&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;organizations:ListPoliciesForTarget&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;organizations:ListRoots&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;organizations:ListPolicies&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;organizations:ListTargetsForPolicy&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;ec2:DescribeInstances&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;eks:DescribeCluster&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">Resource</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;*&quot;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details><h2 class="anchor anchorWithStickyNavbar_LWe7" id="tutorial">Tutorial<a href="#tutorial" class="hash-link" aria-label="Direct link to Tutorial" title="Direct link to Tutorial">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-an-s3-bucket-for-the-server-to-use">Create an S3 bucket for the server to use<a href="#create-an-s3-bucket-for-the-server-to-use" class="hash-link" aria-label="Direct link to Create an S3 bucket for the server to use" title="Direct link to Create an S3 bucket for the server to use">â€‹</a></h3><p>First, we need to pick an S3 bucket name. Because S3 buckets are globally unique, we will save the bucket name in an environment variable for use later.</p><div class="language-bash codeBlockContainer_APcc theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-bash codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#ffffff"><span class="token builtin class-name" style="color:#FAC863">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#d7deea">BUCKET_NAME</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">otterize-tutorial-bucket-</span><span class="token variable" style="color:#d7deea">`</span><span class="token variable function" style="color:#79b6f2">date</span><span class="token variable" style="color:#d7deea"> +%s</span><span class="token variable" style="color:#d7deea">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token builtin class-name" style="color:#FAC863">echo</span><span class="token plain"> </span><span class="token variable" style="color:#d7deea">$BUCKET_NAME</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_APcc theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-bash codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#ffffff"><span class="token plain">aws s3api create-bucket --bucket </span><span class="token variable" style="color:#d7deea">$BUCKET_NAME</span><span class="token plain"> --region us-west-2 --create-bucket-configuration </span><span class="token assign-left variable" style="color:#d7deea">LocationConstraint</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">us-west-2</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-the-sample-server-and-client">Deploy the sample server and client<a href="#deploy-the-sample-server-and-client" class="hash-link" aria-label="Direct link to Deploy the sample server and client" title="Direct link to Deploy the sample server and client">â€‹</a></h3><div class="language-shell codeBlockContainer_APcc theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-shell codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#ffffff"><span class="token plain">kubectl create namespace otterize-tutorial-iam</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">kubectl apply -n otterize-tutorial-iam -f https://docs.otterize.com/code-examples/aws-iam-eks/client-and-server.yaml</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">kubectl patch deployment -n otterize-tutorial-iam server --type</span><span class="token operator" style="color:#d7deea">=</span><span class="token string" style="color:#8dc891">&#x27;json&#x27;</span><span class="token plain"> -p</span><span class="token operator" style="color:#d7deea">=</span><span class="token string" style="color:#8dc891">&quot;[{</span><span class="token string entity" style="color:#d7deea">\&quot;</span><span class="token string" style="color:#8dc891">op</span><span class="token string entity" style="color:#d7deea">\&quot;</span><span class="token string" style="color:#8dc891">: </span><span class="token string entity" style="color:#d7deea">\&quot;</span><span class="token string" style="color:#8dc891">replace</span><span class="token string entity" style="color:#d7deea">\&quot;</span><span class="token string" style="color:#8dc891">, </span><span class="token string entity" style="color:#d7deea">\&quot;</span><span class="token string" style="color:#8dc891">path</span><span class="token string entity" style="color:#d7deea">\&quot;</span><span class="token string" style="color:#8dc891">: </span><span class="token string entity" style="color:#d7deea">\&quot;</span><span class="token string" style="color:#8dc891">/spec/template/spec/containers/0/env</span><span class="token string entity" style="color:#d7deea">\&quot;</span><span class="token string" style="color:#8dc891">, </span><span class="token string entity" style="color:#d7deea">\&quot;</span><span class="token string" style="color:#8dc891">value</span><span class="token string entity" style="color:#d7deea">\&quot;</span><span class="token string" style="color:#8dc891">: [{</span><span class="token string entity" style="color:#d7deea">\&quot;</span><span class="token string" style="color:#8dc891">name</span><span class="token string entity" style="color:#d7deea">\&quot;</span><span class="token string" style="color:#8dc891">: </span><span class="token string entity" style="color:#d7deea">\&quot;</span><span class="token string" style="color:#8dc891">BUCKET_NAME</span><span class="token string entity" style="color:#d7deea">\&quot;</span><span class="token string" style="color:#8dc891">, </span><span class="token string entity" style="color:#d7deea">\&quot;</span><span class="token string" style="color:#8dc891">value</span><span class="token string entity" style="color:#d7deea">\&quot;</span><span class="token string" style="color:#8dc891">: </span><span class="token string entity" style="color:#d7deea">\&quot;</span><span class="token string variable" style="color:#d7deea">$BUCKET_NAME</span><span class="token string entity" style="color:#d7deea">\&quot;</span><span class="token string" style="color:#8dc891">}]}]&quot;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Expand to see the deployment YAML</summary><div><div class="collapsibleContent_i85q"><div class="language-yaml codeBlockContainer_APcc theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-yaml codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#ffffff"><span class="token key atrule" style="color:#FAC863">apiVersion</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">kind</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">metadata</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> server</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">spec</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">replicas</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">selector</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">matchLabels</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">app</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> server</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">template</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">metadata</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">labels</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token key atrule" style="color:#FAC863">app</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> server</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">spec</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">serviceAccountName</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> server</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">containers</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#FAC863">name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> server</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">          </span><span class="token key atrule" style="color:#FAC863">imagePullPolicy</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> Always</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">          </span><span class="token key atrule" style="color:#FAC863">image</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;public.ecr.aws/e3b4k2v5/ekstutorial:server&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">          </span><span class="token key atrule" style="color:#FAC863">ports</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#FAC863">containerPort</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">apiVersion</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">kind</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">metadata</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> server</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">spec</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">type</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> ClusterIP</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">selector</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">app</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> server</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">ports</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#FAC863">name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> http</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">port</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">targetPort</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">apiVersion</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">kind</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> ServiceAccount</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">metadata</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> server</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">apiVersion</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">kind</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">metadata</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> client</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">spec</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">replicas</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">selector</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">matchLabels</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">app</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> client</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">template</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">metadata</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">labels</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token key atrule" style="color:#FAC863">app</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> client</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">spec</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">containers</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#FAC863">name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> client</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">          </span><span class="token key atrule" style="color:#FAC863">imagePullPolicy</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> Always</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">          </span><span class="token key atrule" style="color:#FAC863">image</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;public.ecr.aws/e3b4k2v5/ekstutorial:client&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">          </span><span class="token key atrule" style="color:#FAC863">ports</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#FAC863">containerPort</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details><h3 class="anchor anchorWithStickyNavbar_LWe7" id="view-logs-for-the-server---access-denied">View logs for the server - access denied<a href="#view-logs-for-the-server---access-denied" class="hash-link" aria-label="Direct link to View logs for the server - access denied" title="Direct link to View logs for the server - access denied">â€‹</a></h3><p>The server logs will show that it fails to upload files to the S3 bucket.</p><div class="language-bash codeBlockContainer_APcc theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-bash codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#ffffff"><span class="token plain">kubectl logs -f -n otterize-tutorial-iam deploy/server</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_APcc theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-bash codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#ffffff"><span class="token number" style="color:#5a9bcf">2023</span><span class="token plain">/11/17 </span><span class="token number" style="color:#5a9bcf">19</span><span class="token plain">:08:30 Couldn</span><span class="token string" style="color:#8dc891">&#x27;t upload file testfile.0.txt to otterize-tutorial-bucket-1700247949:testfile.0.txt.</span><br></span><span class="token-line" style="color:#ffffff"><span class="token string" style="color:#8dc891">Here&#x27;</span><span class="token plain">s why: operation error S3: PutObject, https response error StatusCode: </span><span class="token number" style="color:#5a9bcf">403</span><span class="token plain">, RequestID: W9ZBNWPDFEMTBBS5, HostID: gsOlyxAmcUqFiYKzB7IwBoPia/Z2TDHEoaJjXT/qAxdduD4H17XDoGu21Pb7zeMms/YeThv2mJk</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">,</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">api error AccessDenied: Access Denied</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="label-the-server-pod-to-create-an-aws-iam-role">Label the server pod to create an AWS IAM role<a href="#label-the-server-pod-to-create-an-aws-iam-role" class="hash-link" aria-label="Direct link to Label the server pod to create an AWS IAM role" title="Direct link to Label the server pod to create an AWS IAM role">â€‹</a></h3><p>Label the server <code>Pod</code> so that the Otterize credentials operator creates an AWS IAM role for it and binds its Kubernetes ServiceAccount to the newly created role.</p><div class="language-yaml codeBlockContainer_APcc theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-yaml codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#ffffff"><span class="token key atrule" style="color:#FAC863">metadata</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">labels</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">credentials-operator.otterize.com/create-aws-role</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;true&quot;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To do this, we won&#x27;t be labeling the <code>Pod</code> directly, but instead patching the <code>template</code> attribute of the <code>Deployment</code> we created earlier so that it updates the <code>Pod</code>.</p><div class="language-bash codeBlockContainer_APcc theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-bash codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#ffffff"><span class="token plain">kubectl patch deployment -n otterize-tutorial-iam server -p </span><span class="token string" style="color:#8dc891">&#x27;{&quot;spec&quot;: {&quot;template&quot;:{&quot;metadata&quot;:{&quot;labels&quot;:{&quot;credentials-operator.otterize.com/create-aws-role&quot;:&quot;true&quot;}}}} }&#x27;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="an-aws-iam-role-was-created">An AWS IAM role was created<a href="#an-aws-iam-role-was-created" class="hash-link" aria-label="Direct link to An AWS IAM role was created" title="Direct link to An AWS IAM role was created">â€‹</a></h4><p>Let&#x27;s inspect the created role:</p><div class="language-bash codeBlockContainer_APcc theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-bash codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#ffffff"><span class="token plain">aws iam list-roles --query </span><span class="token string" style="color:#8dc891">&#x27;Roles[?starts_with(RoleName, `otr-`) == `true`]&#x27;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the output, you should see that a role was created, with an <code>AssumeRolePolicyDocument</code> that enables the server&#x27;s ServiceAccount to AssumeRole.</p><div class="language-json codeBlockContainer_APcc theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-json codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">&quot;Path&quot;</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;/&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">&quot;RoleName&quot;</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;otr-otterize-tutorial-iam.server@otterize-iam-eks-tutoria-ef91a7&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">&quot;RoleId&quot;</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;AROAVEOJOW5YM2CXSB4FJ&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">&quot;Arn&quot;</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;arn:aws:iam::353146681200:role/otr-otterize-tutorial-iam.server@otterize-iam-eks-tutoria-ef91a7&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">&quot;CreateDate&quot;</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;2023-11-21T12:03:42+00:00&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">&quot;AssumeRolePolicyDocument&quot;</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token property" style="color:#5a9bcf">&quot;Version&quot;</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;2012-10-17&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token property" style="color:#5a9bcf">&quot;Statement&quot;</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                    </span><span class="token property" style="color:#5a9bcf">&quot;Effect&quot;</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;Allow&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                    </span><span class="token property" style="color:#5a9bcf">&quot;Principal&quot;</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                        </span><span class="token property" style="color:#5a9bcf">&quot;Federated&quot;</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;arn:aws:iam::353146681200:oidc-provider/oidc.eks.us-west-2.amazonaws.com/id/84E95D704D69DB40F4E4B6B6A6777CA3&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                    </span><span class="token property" style="color:#5a9bcf">&quot;Action&quot;</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;sts:AssumeRoleWithWebIdentity&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                    </span><span class="token property" style="color:#5a9bcf">&quot;Condition&quot;</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                        </span><span class="token property" style="color:#5a9bcf">&quot;StringEquals&quot;</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">                            </span><span class="token property" style="color:#5a9bcf">&quot;oidc.eks.us-west-2.amazonaws.com/id/84E95D704D69DB40F4E4B6B6A6777CA3:aud&quot;</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;sts.amazonaws.com&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">                            </span><span class="token property" style="color:#5a9bcf">&quot;oidc.eks.us-west-2.amazonaws.com/id/84E95D704D69DB40F4E4B6B6A6777CA3:sub&quot;</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;system:serviceaccount:otterize-tutorial-iam:server&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">...</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="the-kubernetes-serviceaccount-was-annotated-with-the-role-arn">The Kubernetes ServiceAccount was annotated with the role ARN<a href="#the-kubernetes-serviceaccount-was-annotated-with-the-role-arn" class="hash-link" aria-label="Direct link to The Kubernetes ServiceAccount was annotated with the role ARN" title="Direct link to The Kubernetes ServiceAccount was annotated with the role ARN">â€‹</a></h4><p>The credentials operator automatically annotated the Kubernetes ServiceAccount for the server pod with the newly created role ARN.</p><p>Let&#x27;s look at the service account:</p><div class="language-bash codeBlockContainer_APcc theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-bash codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#ffffff"><span class="token plain">kubectl get serviceaccount -n otterize-tutorial-iam server -o yaml</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-yaml codeBlockContainer_APcc theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-yaml codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#ffffff"><span class="token key atrule" style="color:#FAC863">apiVersion</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">kind</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> ServiceAccount</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">metadata</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">annotations</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">eks.amazonaws.com/role-arn</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">      arn</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain">aws</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain">iam</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain">353146681200</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain">role/otr</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">otterize</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">tutorial</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">iam.server@otterize</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">iam</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">eks</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">tutoria</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">ef91a7</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> server</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">namespace</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> otterize</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">tutorial</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">iam</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="apply-intents-to-create-the-necessary-iam-policy">Apply intents to create the necessary IAM policy<a href="#apply-intents-to-create-the-necessary-iam-policy" class="hash-link" aria-label="Direct link to Apply intents to create the necessary IAM policy" title="Direct link to Apply intents to create the necessary IAM policy">â€‹</a></h3><p>By annotating the pod, we&#x27;ve created an IAM role. We now need to specify what we need to access, and the intents operator will create an IAM policy accordingly.</p><p>We will specify the following ClientIntents, granting the PutObject permission to the <code>otterize-tutorial-bucket</code> S3 bucket.</p><div class="language-yaml codeBlockContainer_APcc theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-yaml codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#ffffff"><span class="token key atrule" style="color:#FAC863">apiVersion</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> k8s.otterize.com/v1alpha3</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">kind</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> ClientIntents</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">metadata</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> server</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">spec</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">service</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> server</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">calls</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#FAC863">name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> arn</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain">aws</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain">s3</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain">otterize</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">tutorial</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">bucket</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token important" style="font-weight:400">*/*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">type</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> aws</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">awsActions</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;s3:PutObject&quot;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To apply these intents, run the following command:</p><div class="language-bash codeBlockContainer_APcc theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-bash codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#ffffff"><span class="token plain">kubectl apply -n otterize-tutorial-iam -f https://docs.otterize.com/code-examples/aws-iam-eks/clientintents.yaml</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-server-can-now-upload-files-to-s3">The server can now upload files to S3!<a href="#the-server-can-now-upload-files-to-s3" class="hash-link" aria-label="Direct link to The server can now upload files to S3!" title="Direct link to The server can now upload files to S3!">â€‹</a></h3><p>Let&#x27;s look at the server logs again to see that no more errors are being reported:</p><div class="language-bash codeBlockContainer_APcc theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-bash codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#ffffff"><span class="token plain">kubectl logs -f -n otterize-tutorial-iam deploy/server</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-json codeBlockContainer_APcc theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-json codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#ffffff"><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">  </span><span class="token property" style="color:#5a9bcf">&quot;status&quot;</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">200</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token property" style="color:#5a9bcf">&quot;host&quot;</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">&quot;server&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token property" style="color:#5a9bcf">&quot;method&quot;</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">&quot;POST&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token property" style="color:#5a9bcf">&quot;uri&quot;</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">&quot;/upload&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s list the contents of the S3 bucket:</p><div class="language-bash codeBlockContainer_APcc theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-bash codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#ffffff"><span class="token plain">aws s3 </span><span class="token function" style="color:#79b6f2">ls</span><span class="token plain"> </span><span class="token variable" style="color:#d7deea">$BUCKET_NAME</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_APcc theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-bash codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#ffffff"><span class="token number" style="color:#5a9bcf">2023</span><span class="token plain">-11-17 </span><span class="token number" style="color:#5a9bcf">20</span><span class="token plain">:43:05         </span><span class="token number" style="color:#5a9bcf">19</span><span class="token plain"> testfile.0.txt</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2023</span><span class="token plain">-11-17 </span><span class="token number" style="color:#5a9bcf">20</span><span class="token plain">:42:35         </span><span class="token number" style="color:#5a9bcf">19</span><span class="token plain"> testfile.1.txt</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2023</span><span class="token plain">-11-17 </span><span class="token number" style="color:#5a9bcf">20</span><span class="token plain">:42:45         </span><span class="token number" style="color:#5a9bcf">19</span><span class="token plain"> testfile.2.txt</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2023</span><span class="token plain">-11-17 </span><span class="token number" style="color:#5a9bcf">20</span><span class="token plain">:42:55         </span><span class="token number" style="color:#5a9bcf">19</span><span class="token plain"> testfile.3.txt</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="whats-next">What&#x27;s next?<a href="#whats-next" class="hash-link" aria-label="Direct link to What&#x27;s next?" title="Direct link to What&#x27;s next?">â€‹</a></h3><p>Try out some of the other quick tutorials to learn about how to use ClientIntents to manage network policies, Istio policies, PostgreSQL access, and more. You can use a single ClientIntents resource to specify all the access required for a pod.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="teardown">Teardown<a href="#teardown" class="hash-link" aria-label="Direct link to Teardown" title="Direct link to Teardown">â€‹</a></h2><p>To remove the deployed examples run:</p><div class="language-bash codeBlockContainer_APcc theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-bash codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#ffffff"><span class="token plain">kubectl delete namespace otterize-tutorial-iam</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To delete the cluster, if you created the one in this tutorial:</p><div class="language-bash codeBlockContainer_APcc theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-bash codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#ffffff"><span class="token plain">eksctl delete cluster -f cluster-config.yaml</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To empty and delete the S3 bucket created for this tutorial:</p><div class="language-bash codeBlockContainer_APcc theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-bash codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#ffffff"><span class="token plain">aws s3 </span><span class="token function" style="color:#79b6f2">rm</span><span class="token plain"> s3://otterize-tutorial-bucket --recursive</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">aws s3 rb s3://otterize-tutorial-bucket</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/otterize/docs/edit/main/docs/features/aws-iam/tutorials/aws-iam-eks.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/features/aws-iam"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">AWS IAM | Overview</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/features/aws-iam/tutorials/aws-visibility"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">AWS resource mapping &amp; IAM policy generation</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a><ul><li><a href="#1-create-an-aws-eks-cluster" class="table-of-contents__link toc-highlight">1. Create an AWS EKS cluster</a></li><li><a href="#2-deploy-otterize-for-aws-iam" class="table-of-contents__link toc-highlight">2. Deploy Otterize for AWS IAM</a></li></ul></li><li><a href="#tutorial" class="table-of-contents__link toc-highlight">Tutorial</a><ul><li><a href="#create-an-s3-bucket-for-the-server-to-use" class="table-of-contents__link toc-highlight">Create an S3 bucket for the server to use</a></li><li><a href="#deploy-the-sample-server-and-client" class="table-of-contents__link toc-highlight">Deploy the sample server and client</a></li><li><a href="#view-logs-for-the-server---access-denied" class="table-of-contents__link toc-highlight">View logs for the server - access denied</a></li><li><a href="#label-the-server-pod-to-create-an-aws-iam-role" class="table-of-contents__link toc-highlight">Label the server pod to create an AWS IAM role</a></li><li><a href="#apply-intents-to-create-the-necessary-iam-policy" class="table-of-contents__link toc-highlight">Apply intents to create the necessary IAM policy</a></li><li><a href="#the-server-can-now-upload-files-to-s3" class="table-of-contents__link toc-highlight">The server can now upload files to S3!</a></li><li><a href="#whats-next" class="table-of-contents__link toc-highlight">What&#39;s next?</a></li></ul></li><li><a href="#teardown" class="table-of-contents__link toc-highlight">Teardown</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__links text--center"><div class="footer__links"><span class="footer__link-item">
                <div class="footer_left">
                  <div class="tw-w-96 tw-h-60 tw-flex-col tw-justify-start tw-items-start tw-gap-6 tw-inline-flex">
                    <div class="tw-w-36 tw-h-8 tw-justify-start tw-items-start tw-inline-flex">
                      <img class="tw-w-40 tw-h-16 tw-relative tw-rounded-lg" src="/img/logo.svg">
                    </div>
                    <div id="mailchimp_title" class="tw-w-96 tw-text-gray-700 tw-text-xl tw-font-normal tw-font-sans tw-text-left">Join our newsletter to stay up to date on features and releases.</div>
                    <div class="tw-h-28 tw-flex-col tw-justify-start tw-items-start tw-gap-1.5 tw-flex">
                      <div class="tw-self-stretch tw-h-14 tw-flex-col tw-justify-start tw-items-start tw-gap-1.5 tw-flex">
                        <form name="embedded-subscribe-form" id="mailchimp_form" class="tw-self-stretch tw-pl-3 tw-pr-1.5 tw-py-1.5 tw-bg-gray-50 tw-rounded-2xl tw-shadow tw-justify-start tw-items-center tw-gap-2 tw-inline-flex">
                          <input id="mailchimp_email_input" type="email" name="EMAIL" placeholder="Enter your email" required="" class="tw-w-full tw-text-gray-600 tw-text-base tw-font-normal tw-leading-normal tw-bg-gray-50 tw-border-none tw-h-12 tw-justify-start tw-items-center tw-gap-2 tw-flex tw-focus:outline-none tw-rounded-none tw-shadow-none tw-px-0 focus:tw-outline-none">
                          <button id="mailchimp_cta" type="submit" class="tw-w-auto tw-text-base tw-font-medium tw-leading-normal tw-px-6 tw-py-3 tw-rounded-xl tw-border tw-justify-center tw-items-center tw-gap-2 tw-flex tw:max-h-12 tw-text-white tw-cursor-pointer" style="background: linear-gradient(180deg, #635DFF 0%, #4D3DF7 100%), #7069FB;">Subscribe</button>
                        </form>
                      </div>
                      <div class="tw-text-left tw-self-stretch tw-text-gray-600 tw-text-sm tw-font-normal tw-font-sans tw-leading-tight tw-mt-1">By subscribing you agree to with our Privacy Policy and to receive updates from us.</div>
                    </div>
                  </div>
                </div>
                </span><span class="footer__link-separator">Â·</span><span class="footer__link-item"><div class="footer_right tw-w-auto">
                    <div class="tw-w-full tw-h-60 tw-justify-start tw-items-start tw-inline-flex tw-gap-32">
                      <div class="tw-grow tw-shrink tw-basis-0 tw-flex-col tw-justify-start tw-items-start tw-gap-4 tw-inline-flex tw-w-[120px] tw-max-w-[240px]">
                        <div class="tw-self-stretch tw-text-gray-500 tw-text-sm tw-font-semibold tw-font-sans tw-uppercase tw-leading-none tw-tracking-widest tw-text-left">Platform</div>
                          
<div class="tw-self-stretch tw-h-20 tw-flex-col tw-justify-start tw-items-start tw-flex tw-text-left">
  <div class="tw-self-stretch tw-py-2 tw-justify-start tw-items-start tw-inline-flex">
    <a href="https://www.otterize.com/open-source" class="tw-grow tw-shrink tw-basis-0 tw-text-sky-950 tw-text-base tw-font-medium tw-font-sans tw-leading-normal !tw-no-underline">Open Source</a>
  </div>
  <div class="tw-self-stretch tw-py-2 tw-justify-start tw-items-start tw-inline-flex">
    <a href="https://www.otterize.com/cloud" class="tw-grow tw-shrink tw-basis-0 tw-text-sky-950 tw-text-base tw-font-medium tw-font-sans tw-leading-normal !tw-no-underline">Otterize Cloud</a>
  </div>
</div>

                      </div>
                      <div class="tw-grow tw-shrink tw-basis-0 tw-flex-col tw-justify-start tw-items-start tw-gap-4 tw-inline-flex tw-w-[120px] tw-max-w-[240px]">
                        <div class="tw-self-stretch tw-text-gray-500 tw-text-sm tw-font-semibold tw-font-sans tw-uppercase tw-leading-none tw-tracking-widest tw-text-left">resources</div>
                        
<div class="tw-self-stretch tw-h-40 tw-flex-col tw-justify-start tw-items-start tw-flex tw-text-left">
  <div class="tw-self-stretch tw-py-2 tw-justify-start tw-items-start tw-inline-flex">
    <a href="/" class="tw-grow tw-shrink tw-basis-0 tw-text-sky-950 tw-text-base tw-font-medium tw-font-sans tw-leading-normal tw-cursor-pointer !tw-no-underline">Documentation</a>
  </div>
  <div class="tw-self-stretch tw-py-2 tw-justify-start tw-items-start tw-inline-flex">
    <a href="https://www.otterize.com/resources" class="tw-grow tw-shrink tw-basis-0 tw-text-sky-950 tw-text-base tw-font-medium tw-font-sans tw-leading-normal tw-cursor-pointer !tw-no-underline">Resource Hub</a>
  </div>
  <div class="tw-self-stretch tw-py-2 tw-justify-start tw-items-start tw-inline-flex">
    <a href="https://www.otterize.com/team" class="tw-grow tw-shrink tw-basis-0 tw-text-sky-950 tw-text-base tw-font-medium tw-font-sans tw-leading-normal tw-cursor-pointer !tw-no-underline">About Us</a>
  </div>
  <div class="tw-self-stretch tw-py-2 tw-justify-start tw-items-start tw-inline-flex">
    <a href="https://www.otterize.com/pricing" class="tw-grow tw-shrink tw-basis-0 tw-text-sky-950 tw-text-base tw-font-medium tw-font-sans tw-leading-normal tw-cursor-pointer !tw-no-underline">Pricing</a>
  </div>
</div>

                      </div>
                      <div class="tw-grow tw-shrink tw-basis-0 tw-flex-col tw-justify-start tw-items-start tw-gap-4 tw-inline-flex tw-w-[120px] tw-max-w-[240px]">
                        <div class="tw-self-stretch tw-text-gray-500 tw-text-sm tw-font-semibold tw-font-sans tw-uppercase tw-leading-none tw-tracking-widest tw-text-left">Follow Us</div>
                        <ul class="tw-relative tw-z-10 tw-flex-col tw-justify-between tw-items-start tw-flex tw-gap-4 tw-w-full tw-mt-2 tw-text-left">
                        
<a href="https://github.com/otterize?view_as=public">
  <img width="30" height="30" loading="lazy" src="/img/footer/github.svg" alt="GitHub logo" classname="w-5 h-5 relative">
</a>
<a href="https://www.linkedin.com/company/otterize">
  <img width="30" height="30" loading="lazy" src="/img/footer/linkedin.svg" alt="LinkedIn logo" classname="w-5 h-5 relative">
</a>
<a href="https://x.com/TheOtterize">
  <img width="30" height="30" loading="lazy" src="/img/footer/x.svg" alt="X logo" classname="w-5 h-5 relative">
</a>
<a href="https://joinslack.otterize.com/">
  <img width="30" height="30" loading="lazy" src="/img/footer/slack.svg" alt="Slack logo" classname="w-5 h-5 relative">
</a>
<a href="https://www.youtube.com/@the-otterize/featured">
  <img width="30" height="30" loading="lazy" src="/img/footer/youtube.svg" alt="YouTube logo" classname="w-5 h-5 relative">
</a>

                        </ul>
                      </div>
                    </div>
                  </div></span><span class="footer__link-separator">Â·</span><span class="footer__link-item"><div class="footer_copyright tw-w-full">
                    <div style="display:flex;">
                      <img src="/img/footer/cloud-native.svg" style="margin-right:20px;">
                      <a href="https://otterize.com/soc2-request" target="_blank" style="height:50px;">
                        <img src="/img/footer/soc.png" style="width:50px;">
                      </a>
                    </div>
                    <div class="tw-w-full tw-h-14 tw-flex-col tw-justify-start tw-items-start tw-gap-8 tw-inline-flex">
                    <div class="tw-self-stretch tw-h-px tw-bg-gray-300"></div>
                    <div class="tw-self-stretch tw-justify-between tw-items-start tw-inline-flex">
                      <div class="tw-text-gray-500 tw-text-sm tw-font-normal tw-font-sans tw-leading-tight">Â© 2024 Otterize. All rights reserved.</div>
                      <div class="tw-justify-start tw-items-start tw-gap-6 tw-flex">
                        <a href="https://status.otterize.com/" class="tw-text-gray-500 tw-text-sm tw-font-medium tw-font-sans tw-leading-tight !tw-no-underline">Service Status</a>
                        <a href="https://otterize.com/privacy" class="tw-text-gray-500 tw-text-sm tw-font-medium tw-font-sans tw-leading-tight !tw-no-underline">Privacy Policy</a>
                        <a href="https://otterize.com/terms" class="tw-text-gray-500 tw-text-sm tw-font-medium tw-font-sans tw-leading-tight !tw-no-underline">Terms of Service</a>
                        <a href="" class="tw-text-gray-500 tw-text-sm tw-font-medium tw-font-sans tw-leading-tight !tw-no-underline">Cookies Settings</a>
                      </div>
                    </div>
                  </div>
                </div></span></div></div></div></footer></div>
<script src="/assets/js/runtime~main.f7bd300b.js"></script>
<script src="/assets/js/main.ec6cc63b.js"></script>
</body>
</html>